"use strict";(self.webpackChunkstartbuilding=self.webpackChunkstartbuilding||[]).push([[862],{6549:function(e,n,t){t(2791);n.Z=t.p+"static/media/apple.7f266128e9ea9928775383a0a3930d6e.svg"},8006:function(e,n,t){t(2791);n.Z=t.p+"static/media/google.b58ffc002585a28021a00030f4b2a965.svg"},4947:function(e,n,t){t(2791);n.Z=t.p+"static/media/linkedin.7ec10e715d53d7e7f09b2649e06a1294.svg"},828:function(e,n,t){t.r(n),t.d(n,{default:function(){return ln}});var i=t(3433),o=t(4942),l=t(1413),r=t(9439),a=t(2791),s=t(9421),d=t(5405),u=t(5861),c=t(7757),v=t.n(c),p=(t(4847),t(5936)),h=t(7707),f=t(430),m=t(2532),g=t(8976),x=t(6588),j=t(7726),w=t(1358),y=t(2652),b=t(8153),Z=t(5397);var k=t.p+"static/media/orange.08ed0737daabcf34240f2a28402d80e9.svg";var N=t.p+"static/media/blue.18e2e570f303f3c69fadb17f6507ed87.svg";var C={orange:k,blue:N,yellow:t.p+"static/media/yellow.95f3abb3465d6d410ba85571b2c9482f.svg"};var S=t.p+"static/media/drawable.e28d4a0198e43cb720feecf652f5a7ed.svg",E=t(8258),A=t(4431),D=(0,E.hg)("createProject",function(){var e=(0,u.Z)(v().mark((function e(n,t){var i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.Z.createProject(n);case 2:return i=e.sent,e.abrupt("return",null===i||void 0===i?void 0:i.content);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()),_=((0,E.oM)({name:"authSlice",initialState:{isLoading:!1,payload:{code:"",content:{description:"",latitude:0,longitude:0,name:""},errors:[],warnings:[]}},reducers:{},extraReducers:function(e){e.addCase(D.pending,(function(e){e.isLoading=!0})),e.addCase(D.fulfilled,(function(e,n){return{payload:n.payload,isLoading:!1}})),e.addCase(D.rejected,(function(e,n){e.isLoading=!1}))}}),t(2183)),L=t(7447),R=t(9409),V=t(8676),T=t(6252),I=t(9236),F=t(927),P=t(6233),z=t(7867),M=t(5850),B=t(6739),O=t(6089),q=(t(4929),t(184));var H=function(e){var n=e.options,t=e.name,i=e.title,o=(e.checked,e.type),r=void 0===o?"checkbox":o,a=e.onChange,s=null!==t&&void 0!==t?t:(Math.random()*Date.now()).toString(),d=function(e,t){var i=(0,l.Z)((0,l.Z)({},t),{},{checked:e.target.checked});"function"===typeof a&&a({target:i,selection:n.map((function(e){var n,t;return(null===(n=i.value)||void 0===n?void 0:n.toString())===(null===(t=e.value)||void 0===t?void 0:t.toString())?i:"radio"===r?(0,l.Z)((0,l.Z)({},e),{},{checked:!1}):e}))})};return n.length>0?(0,q.jsxs)("fieldset",{className:"inline-select-fieldset",children:[i?(0,q.jsx)("legend",{children:i}):null,(0,q.jsx)("div",{className:"options-container",children:n.map((function(e){return(0,q.jsxs)("label",{title:e.description,children:[(0,q.jsx)("input",{onChange:function(n){return d(n,e)},name:s,type:r,defaultChecked:e.checked}),e.label]},e.value)}))})]}):null},U=t(6618);var G=function(e){var n=e.onNext,t=e.entrance,i=e.exit,o=e.projectData,l=(0,a.useState)(""),s=(0,r.Z)(l,2),d=s[0],u=s[1],c=(0,a.useState)(""),v=(0,r.Z)(c,2),p=v[0],h=v[1],f=(0,a.useState)(""),m=(0,r.Z)(f,2),g=m[0],x=m[1],j=(0,a.useState)(""),w=(0,r.Z)(j,2),y=w[0],b=w[1],Z=(0,a.useState)(!0),k=(0,r.Z)(Z,2),N=k[0],C=k[1];return(0,a.useEffect)((function(){var e,n,t,i;u(null!==(e=null===o||void 0===o?void 0:o.name)&&void 0!==e?e:""),h(null!==(n=null===o||void 0===o?void 0:o.description)&&void 0!==n?n:""),x(null!==(t=null===o||void 0===o?void 0:o.contractor)&&void 0!==t?t:""),b(null!==(i=null===o||void 0===o?void 0:o.contractorEmail)&&void 0!==i?i:"")}),[]),(0,q.jsxs)("div",{className:"proj-screen__container ".concat(t?"entrance":""," ").concat(i?"exit":""),children:[(0,q.jsx)("h3",{className:"proj-screen__title",children:"Parlez nous de votre projet"}),(0,q.jsx)(U.Z,{required:!0,value:d,onChange:function(e){return u(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Nom du projet"}),(0,q.jsx)(U.Z,{required:!0,value:p,onChange:function(e){return h(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"D\xe9crivez le en une phrase"}),(0,q.jsx)(H,{options:[{label:"Oui",value:1,checked:!0},{label:"Non",value:0}],title:"Serez vous le ma\xeetre d\u2019ouvrage du projet?",type:"radio",checked:0,onChange:function(e){return C(1===e.target.value)}}),N?null:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(U.Z,{value:g,onChange:function(e){return x(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Nom de la Ma\xeetrise d\u2019ouvrage"}),(0,q.jsx)(U.Z,{value:y,onChange:function(e){return b(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Adresse mail du Ma\xeetre d\u2019ouvrage",type:"email"})]}),(0,q.jsx)(O.Z,{onClick:function(){""!==d.trim()&&""!==p.trim()&&n({name:d,description:p,contractor:g,contractorEmail:y})},round:!0,btnClassName:"proj-continue-btn",icon:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",style:{transform:"rotate(175deg)"},children:(0,q.jsx)("path",{id:"Fl\xe8che-chevron-s",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})}),children:"Continuer"})]})};var W=function(e){var n=e.onNext,t=e.onSave,i=e.entrance,o=e.exit,l=e.projectData,s=(0,a.useState)(""),d=(0,r.Z)(s,2),u=d[0],c=d[1],v=(0,a.useState)(""),p=(0,r.Z)(v,2),h=p[0],f=p[1],m=(0,a.useState)(""),g=(0,r.Z)(m,2),x=g[0],j=g[1],w=(0,a.useState)(""),y=(0,r.Z)(w,2),b=y[0],Z=y[1];return(0,a.useEffect)((function(){var e,n,t,i;c(null!==(e=null===l||void 0===l?void 0:l.workType)&&void 0!==e?e:""),f(null!==(n=null===l||void 0===l?void 0:l.marketType)&&void 0!==n?n:""),j(null!==(t=null===l||void 0===l?void 0:l.team)&&void 0!==t?t:""),Z(null!==(i=null===l||void 0===l?void 0:l.teamRoleId)&&void 0!==i?i:"")}),[]),(0,q.jsxs)("div",{className:"proj-screen__container ".concat(i?"entrance":""," ").concat(o?"exit":""),children:[(0,q.jsx)("h3",{className:"proj-screen__title",children:"Dites nous en plus"}),(0,q.jsx)("h5",{className:"proj-screen__title",children:"sur votre projet"}),(0,q.jsx)(U.Z,{value:u,onChange:function(e){return c(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Typologie de l\u2019ouvrage"}),(0,q.jsx)(U.Z,{value:h,onChange:function(e){return f(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Type de march\xe9"}),(0,q.jsx)("h5",{className:"proj-screen__title",children:"sur vous"}),(0,q.jsx)(U.Z,{value:x,onChange:function(e){return j(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Dans quelle \xe9quipe intervenez-vous?"}),(0,q.jsx)(U.Z,{value:b,onChange:function(e){return Z(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Quel sera votre r\xf4le au sein de l\u2019\xe9quipe?"}),(0,q.jsx)(O.Z,{onClick:function(){n({workType:u,marketType:h,team:x,teamRoleId:b}),t&&t({workType:u,marketType:h,team:x,teamRoleId:b})},round:!0,btnClassName:"proj-continue-btn",icon:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",style:{transform:"rotate(175deg)"},children:(0,q.jsx)("path",{id:"Fl\xe8che-chevron-s",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})}),children:"Continuer"})]})},K=t(3895),Y=t(5791);var $=function(e){var n=e.onNext,t=e.entrance,i=e.exit,s=e.roles,d=e.project,u=(0,a.useState)({}),c=(0,r.Z)(u,2),v=c[0],p=c[1],h=(0,a.useState)(""),f=(0,r.Z)(h,2),m=f[0],g=f[1],x=(0,a.useState)(""),j=(0,r.Z)(x,2),w=j[0],y=j[1],b=(0,a.useState)(""),Z=(0,r.Z)(b,2),k=Z[0],N=Z[1],C=function(e){var n;(null!==e&&void 0!==e&&e.key&&"enter"===(null===e||void 0===e||null===(n=e.key)||void 0===n?void 0:n.toLowerCase())||null===e||void 0===e||!e.key)&&M.sC.isEmail(m)&&(p((function(e){return(0,l.Z)((0,l.Z)({},e),{},(0,o.Z)({},m,{email:m,roleId:0,ms:Date.now()}))})),g(""),y(""),N(""))},S=function(e){p((function(n){var t=(0,l.Z)({},n);return delete t[e],t}))},E=function(e,n){return e.ms&&n.ms?e.ms>n.ms?-1:1:-1},A=(0,a.useMemo)((function(){return Object.values(v).sort(E)}),[v]);return(0,q.jsxs)("div",{className:"proj-screen__container ".concat(t?"entrance":""," ").concat(i?"exit":""),children:[(0,q.jsx)("h3",{className:"proj-screen__title",children:"Inviter des participants"}),(0,q.jsx)("h5",{className:"proj-screen__title",children:"Cette \xe9tape vous permet d\u2019inviter des utilisateurs \xe0 rejoindre ce projet."}),(0,q.jsx)(U.Z,{onKeyDown:C,value:m,onChange:function(e){var n;g(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value),w&&y(""),k&&N("")},style:{with:"80%"},containerClassName:"proj-screen__input",title:"Saisir une adresse email",icon:(0,q.jsxs)("svg",{onClick:C,tabIndex:0,role:"button",className:"plus-svg-54",viewBox:"0 0 100 100",fill:"#F3BE3D",children:[(0,q.jsx)("circle",{cx:50,cy:50,r:50}),(0,q.jsx)("text",{textAnchor:"middle",x:50,y:75,fill:"#fff",fontSize:100,children:"+"})]})}),A.length>0?A.map((function(e){return(0,q.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,q.jsx)(Y.Z,{value:e.email,onDismiss:S}),(0,q.jsx)(H,{onChange:function(n){return t=n,i=e,void p((function(e){return(0,l.Z)((0,l.Z)({},e),{},(0,o.Z)({},i.email,{email:i.email,roleId:t.target.value,ms:i.ms}))}));var t,i},type:"radio",options:s?s.map((function(e){return{value:e.id,label:e.name,description:e.description}})):[]})]},e.email)})):null,w&&A.length>0?(0,q.jsx)("span",{style:{color:"#E33F1A"},children:w}):null,!w&&k?(0,q.jsx)("span",{style:{color:"#E33F1A"},children:k}):null,(0,q.jsx)(O.Z,{onClick:function(){""!==m&&N("".concat(M.sC.isEmail(m)?"Veuillez appuyer sur Entr\xe9e si vous souhaitez inviter "+m:"email ".concat(m," invalide")));try{Object.values(v).forEach((function(e){if(!e.roleId)throw Error("Veuillez s\xe9lectionner un r\xf4le pour chaque participant")})),null!==d&&void 0!==d&&d.id&&K.Z.sendEmail(d.id,{invitations:Object.values(v)}),""===m&&n({})}catch(t){var e;y(null!==(e=null===t||void 0===t?void 0:t.message)&&void 0!==e?e:"")}},round:!0,btnClassName:"proj-continue-btn",icon:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",style:{transform:"rotate(175deg)"},children:(0,q.jsx)("path",{id:"Fl\xe8che-chevron-s",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})}),children:A.length>0?"Inviter ces participants":"Continuer"})]})};var Q=t.p+"static/media/clap.e11804d8958e6b79668b05285348dc58.svg";var J=[G,W,$,function(e){var n=e.onNext,t=e.entrance,i=e.exit,o=e.onComplete,l="Ce projet est maintenant disponible!";return(0,q.jsxs)("div",{className:"proj-screen__container ".concat(t?"entrance":""," ").concat(i?"exit":""),children:[(0,q.jsx)("h3",{className:"proj-screen__title",children:l}),(0,q.jsx)("h5",{className:"proj-screen__title",children:"Gr\xe2ce \xe0 vous, l\u2019ensemble des acteurs va pouvoir rejoindre ce projet."}),(0,q.jsx)("img",{width:150,src:Q,alt:l}),(0,q.jsx)(O.Z,{onClick:function(){n({}),"function"===typeof o&&o()},round:!0,btnClassName:"proj-continue-btn",icon:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",style:{transform:"rotate(175deg)"},children:(0,q.jsx)("path",{id:"Fl\xe8che-chevron-s",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})}),children:"Acc\xe9der au projet"})]})}],X=t(9896);var ee=function(e){var n=e.onDismiss,t=e.onSubmit,i=e.project,o=(0,a.useState)(0),s=(0,r.Z)(o,2),u=s[0],c=s[1],v=(0,a.useState)(!1),p=(0,r.Z)(v,2),h=p[0],f=p[1],m=(0,a.useState)(!1),g=(0,r.Z)(m,2),x=g[0],j=g[1],w=(0,a.useState)({}),y=(0,r.Z)(w,2),b=y[0],Z=y[1],k=(0,a.useState)(),N=(0,r.Z)(k,2),C=N[0],S=N[1],E=(0,d.I)();(0,a.useEffect)((function(){A.Z.getRoleList().then((function(e){return S(e)}))}),[]);var D=(0,a.useMemo)((function(){return J[u]}),[u]),_=function(){E((0,X.xZ)("create_project")),n()};return(0,q.jsxs)("div",{style:{display:"flex",minWidth:"80%"},children:[(0,q.jsx)("div",{style:{flex:2},children:(0,q.jsx)(D,{onSave:function(e){return n=(0,l.Z)((0,l.Z)({},b),e),t&&t(n),void(0,X.xZ)("create_project");var n},onComplete:_,project:i,projectData:b,roles:C,entrance:x,exit:h,onNext:function(e){Z((function(n){return c((function(e){return j(!0),setTimeout((function(){return j(!1)}),300),e<J.length-1?e+1:e})),(0,l.Z)((0,l.Z)({},n),e)}))}})}),(0,q.jsx)("div",{style:{flex:1,display:"flex",justifyContent:"flex-end",alignItems:"flex-start"},children:(0,q.jsxs)("button",{className:"proj-back__btn",onClick:function(){c((function(e){return e>0?(f(!0),setTimeout((function(){return f(!1)}),300),e-1):(_(),0)}))},children:["Retour",(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",children:(0,q.jsx)("path",{id:"Fl\xe8che",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})})]})})]})},ne=t(215),te=t(5334),ie=function(e){var n,t=(0,a.useState)(!1),i=(0,r.Z)(t,2),o=i[0],s=i[1],c=(0,a.useState)(!1),k=(0,r.Z)(c,2),N=(k[0],k[1],(0,a.useState)("")),E=(0,r.Z)(N,2),A=E[0],O=E[1],H=(0,a.useState)([]),U=(0,r.Z)(H,2),G=U[0],W=U[1],K=(0,a.useState)(),Y=(0,r.Z)(K,2),$=Y[0],Q=Y[1],J=(0,a.useState)(),ie=(0,r.Z)(J,2),oe=ie[0],le=ie[1],re=(0,a.useState)(),ae=(0,r.Z)(re,2),se=ae[0],de=ae[1],ue=(0,a.useState)(),ce=(0,r.Z)(ue,2),ve=ce[0],pe=ce[1],he=(0,a.useState)(),fe=(0,r.Z)(he,2),me=fe[0],ge=fe[1],xe=(0,a.useRef)(),je=(0,a.useRef)(),we=(0,a.useRef)(),ye=(0,a.useRef)(),be=(0,a.useRef)();be.current=$;var Ze=(0,a.useRef)();Ze.current=oe;var ke=(0,a.useRef)();ke.current=se,(0,a.useRef)().current=ve;var Ne=(0,d.I)(),Ce=(0,d.v)((function(e){return e})).mapMeta,Se=function(){var e=(0,u.Z)(v().mark((function e(n){var t;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne(D((0,l.Z)((0,l.Z)({},n),{},{longitude:G[0],latitude:G[1]}))).unwrap();case 2:t=e.sent,Ne((0,_.B)(t)),ge(t);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Ee=function(){s(!1),Ne((0,X.xZ)("create_project"))},Ae=function(n){var t,i=n.coordinate,o=n.pixel,l=null===(t=be.current)||void 0===t?void 0:t.forEachFeatureAtPixel(o,(function(e){return e}));if(l)return console.log(l),Ne((0,ne.fR)({is_active:!0,name:l.get("name")})),Ne((0,te.AV)(l.get("id"))),void s(!1);var r,a=(0,Z.bU)(i);W(a);var d=(0,b.V7)(a);a.length>1&&(e.onPin&&(e.onPin({longitude:a[0],latitude:a[1]}),s(!0)),Ne((0,X.Z5)({longitude:a[0],latitude:a[1],description:d}))),O(d),s(!0),je.current.style.display="block",null===(r=Ze.current)||void 0===r||r.setPosition(i),_e()},De=function(e){var n,t=e.coordinate,i=e.pixel;be.current.getTarget().style.cursor="";var o,l=null===(n=be.current)||void 0===n?void 0:n.forEachFeatureAtPixel(i,(function(e){return e}));if(l&&(_e(),be.current.getTarget().style.cursor="pointer",null===(o=ke.current)||void 0===o||o.setPosition(t),we.current)){we.current.style="display: flex; flex-direction: column; position: relative; z-index: 20;";var r=l.get("name"),a=l.get("description");we.current.innerHTML="\n                    ".concat(r?"<h5>".concat(r,"</h5>"):"","\n                    ").concat(a?"<p>".concat(a,"</p>"):"","\n                ")}},_e=function(){we.current&&(we.current.style="display: none;",we.current.innerHTML="")};return(0,a.useEffect)((function(){var e=new w.Z({element:null===je||void 0===je?void 0:je.current,autoPan:{animation:{duration:250}}}),n=new w.Z({element:null===we||void 0===we?void 0:we.current,positioning:"bottom-center",stopEvent:!1}),t=new m.Z,i=new p.Z({target:null===xe||void 0===xe?void 0:xe.current,overlays:[e,n],layers:[new h.Z({source:new g.Z({url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",projection:"EPSG:3857"})}),new L.Z({source:t})],controls:(0,x.ce)().extend([new j.Z]),view:new f.ZP({projection:"EPSG:3857",center:[3,6e6],zoom:5})}),o=new z.Z({source:t});i.addInteraction(o),Q(i),le(e),de(n),pe(t),i.on("click",Ae),i.on("pointermove",De),i.on("movestart",_e)}),[]),(0,a.useEffect)((function(){var n;if($&&ve&&ye.current&&e.pins&&(null===(n=e.pins)||void 0===n?void 0:n.length)>0){var t,i={r:237,g:110,b:64},o=(0,M.$h)(S,i);null===(t=e.pins)||void 0===t||t.forEach((function(n,t){var r,a,s,d,u=new y.Z((0,l.Z)({geometry:new R.Z((0,Z.mi)([n.longitude,n.latitude]))},n)),c=new V.ZP({image:new T.Z({anchor:[.5,0],anchorOrigin:"bottom-right",scale:.5,src:C.orange}),text:new I.Z({font:"10px Calibri,sans-serif",fill:new F.Z({color:"rgb(".concat(i.r,",").concat(i.g,",").concat(i.b,")")}),stroke:new P.Z({color:"#fff",width:2}),text:null!==(r=null===(a=(null!==(s=null===(d=e.pins)||void 0===d?void 0:d.length)&&void 0!==s?s:0)-t)||void 0===a?void 0:a.toString())&&void 0!==r?r:"",offsetY:-o.height/3})});u.setStyle(c),null===ve||void 0===ve||ve.addFeature(u)})),je.current.style.display="none"}}),[e.pins,$]),(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("div",{ref:xe,className:"map",id:"map"}),(0,q.jsx)("div",{onClick:function(e){null===e||void 0===e||e.stopPropagation()},ref:we,className:"ol-tool-tip"}),(0,q.jsx)("img",{ref:je,src:C.blue,className:"project-pointer"}),(0,q.jsx)("img",{ref:ye,src:S,hidden:!0}),o&&!(null===(n=Ce.activities)||void 0===n||!n.create_project)&&(0,q.jsxs)(B.Z,{show:o,el:"#map",container:".background-layout",onDismiss:Ee,children:[(0,q.jsx)("code",{children:A}),(0,q.jsx)(ee,{project:me,onSubmit:Se,onDismiss:Ee})]})]})},oe=t(5987),le=t(4419),re=t.n(le),ae=t(6549),se=t(3280),de=t(810),ue=t(8006),ce=t(2607),ve=t(4023),pe=t(4947),he=t(5211);var fe=t.p+"static/media/member.fb3513941ba1baf12e08119a7024ab11.svg",me=t(2454);var ge=t.p+"static/media/organisation.efa0cfcf500774d1efcb6b093ef829b9.svg";var xe=t.p+"static/media/pin.d2679618240c8b28773a95afcb281fb5.svg",je=t(3834);var we=t.p+"static/media/plus.8a6a02d7c59802bb732d85e8e550ad63.svg";var ye=t.p+"static/media/question.9b793928a44f6612d3dd1f8c551126cc.svg",be=t(9200),Ze=t(447),ke={apple:ae.Z,projet:se.Z,dashboard:de.Z,google:ue.Z,home:ce.Z,house:ve.Z,linkedin:pe.Z,mail:he.Z,equipe:fe,notification:me.Z,organisation:ge,pin:xe,plug:je.Z,empty:we,question:ye,search:be.Z,user:Ze.Z,clap:Q};var Ne=function(e){var n,t,i,o,l,r,s,d=(0,a.useRef)(null),u=e.nodeDatum,c=e.d3ExtraProps,v=e.setActive,p=e.activeNodes,h=e.active,f=e.setEmptyNodePlacement,m=u.attributes,g=m.id,x=m.nodeType,j=m.iconName,w=p&&p[g],y=h===g,b=c.hierarchyPointNode,Z=(null===b||void 0===b||null===(n=b.parent)||void 0===n||null===(t=n.data)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.id)===h||null===(null===b||void 0===b?void 0:b.parent),k=y?"#295EA7":"#fff",N="empty"===x,C="",S=null!==(o=e.nodeSize)&&void 0!==o?o:52,E=ke.question;return N&&(k="#F3BE3D"),j in ke?E=ke[j]:x in ke&&(E=ke[x]),C=w?y?"#555":"#295EA7":"#959595",N&&!Z?null:(0,q.jsxs)("svg",{x:-S/2,y:-S/2,viewBox:"0 0 ".concat(S," ").concat(S),width:S,height:S,onClick:function(e){"function"!==typeof v||N||v(b),f&&N&&f({showForm:!0,node:b,el:null===d||void 0===d?void 0:d.current})},ref:d,children:[(0,q.jsxs)("g",{children:[(0,q.jsx)("circle",{fill:k,cy:S/2,cx:S/2,id:g,r:S/2-(w&&!y?3:0),strokeWidth:w&&!y?3:0,stroke:"#295EA7"}),(0,q.jsx)("image",{viewBox:"0 0 ".concat(S," ").concat(S),x:"25%",y:"25%",xlinkHref:E,width:"50%",height:"50%",preserveAspectRatio:"xMidYMid slice"}),(0,q.jsx)("text",{y:S/2,x:S/2,strokeWidth:0,fontSize:10,fill:C,alignmentBaseline:"middle",textAnchor:"middle",children:(null===u||void 0===u||null===(l=u.name)||void 0===l?void 0:l.length)>9?(null===u||void 0===u||null===(r=u.name)||void 0===r?void 0:r.substring(0,7))+"...":null===u||void 0===u?void 0:u.name})]}),(0,q.jsx)("title",{children:null===(s=u.attributes)||void 0===s?void 0:s.description})]})},Ce=function(e){var n,t,i,o,l,s,u,c,v,p,h=e.placement,f=e.onSubmit,m=e.mapCoords,g=e.onClose,x=(0,d.v)((function(e){return e})).projectNodeTypes,j=null===h||void 0===h||null===(n=h.el)||void 0===n?void 0:n.getBoundingClientRect(),w=(0,a.useState)(""),y=(0,r.Z)(w,2),b=y[0],Z=y[1],k=(0,a.useState)(""),N=(0,r.Z)(k,2),C=N[0],S=N[1],E=(0,a.useState)(""),A=(0,r.Z)(E,2),D=A[0],_=A[1],L=(0,a.useState)(null),R=(0,r.Z)(L,2),V=R[0],T=R[1],I=(0,a.useState)(""),F=(0,r.Z)(I,2),P=(F[0],F[1]);(0,a.useEffect)((function(){var e,n;x.payload&&(null===(e=x.payload)||void 0===e?void 0:e.length)>0&&Z(null===x||void 0===x||null===(n=x.payload[0])||void 0===n?void 0:n.id)}),[x]),(0,a.useEffect)((function(){var e;m?T(m):null!==h&&void 0!==h&&h.node&&null===(null===h||void 0===h||null===(e=h.node)||void 0===e?void 0:e.parent)&&(0,M.vW)().then((function(e){return T(null===e||void 0===e?void 0:e.coords)}),(function(e){console.log("error geting position",e),P("Veuillez activer la localisation sur votre navigateur")}))}),[m,h]);return(0,q.jsx)("div",{style:{position:"absolute",top:"".concat(null!==(t=null===j||void 0===j?void 0:j.y)&&void 0!==t?t:0,"px"),left:"".concat(null!==(i=null===j||void 0===j?void 0:j.right)&&void 0!==i?i:0,"px"),zIndex:1100},children:(0,q.jsxs)("div",{className:"placement-form-u0",children:[(0,q.jsx)("button",{className:"placement-close-icon",onClick:function(e){g&&g()},children:(0,q.jsx)("svg",{fill:"#000000",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24px",height:"24px",children:(0,q.jsx)("path",{d:"M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"})})}),(0,q.jsxs)("div",{className:"placement-title",children:["Ajouter un nouveau ",null===(null===h||void 0===h||null===(o=h.node)||void 0===o?void 0:o.parent)?"projet":"n\u0153ud \xe0 ".concat(null===h||void 0===h||null===(l=h.node)||void 0===l||null===(s=l.parent)||void 0===s||null===(u=s.data)||void 0===u?void 0:u.name)]}),null!==(c=h.node)&&void 0!==c&&c.parent&&x&&!x.isLoading&&null!==x&&void 0!==x&&x.payload&&(null===x||void 0===x||null===(v=x.payload)||void 0===v?void 0:v.length)>0?(0,q.jsx)("select",{value:b,onChange:function(e){var n;return Z(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)},children:x.payload.filter((function(e){return"empty"!==(null===e||void 0===e?void 0:e.label)&&"projet"!==(null===e||void 0===e?void 0:e.label)})).map((function(e){return(0,q.jsx)("option",{value:null===e||void 0===e?void 0:e.id,children:null===e||void 0===e?void 0:e.label},(null===e||void 0===e?void 0:e.id)+(null===e||void 0===e?void 0:e.label))}))}):null,null===(null===h||void 0===h||null===(p=h.node)||void 0===p?void 0:p.parent)?(0,q.jsx)("input",{readOnly:!0,type:"search",placeholder:"Emplacement du projet",value:V?"".concat(null===V||void 0===V?void 0:V.longitude,", ").concat(null===V||void 0===V?void 0:V.longitude):""}):null,(0,q.jsxs)("div",{style:{position:"relative"},children:[(0,q.jsx)("span",{style:{color:"#E33F1A",position:"absolute",left:5,top:"20%"},children:"*"}),(0,q.jsx)("input",{required:!0,style:{paddingLeft:10},placeholder:"nom",value:C,onChange:function(e){var n;return S(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)}})]}),(0,q.jsx)("div",{children:(0,q.jsx)("textarea",{placeholder:"description",value:D,onChange:function(e){var n;return _(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)}})}),(0,q.jsx)("div",{children:(0,q.jsx)("button",{disabled:!(null!==C&&void 0!==C&&C.trim()),onClick:function(){var e,n,t,i;h.node&&C&&f({name:C,typeId:b,description:D,longitude:null===V||void 0===V?void 0:V.longitude,latitude:null===V||void 0===V?void 0:V.latitude,parentNodeId:null===h||void 0===h||null===(e=h.node)||void 0===e||null===(n=e.parent)||void 0===n||null===(t=n.data)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.id})},children:"Add"})})]})})},Se=["nodeDatum","toggleNode"],Ee=function(e){var n=e.treeData,t=e.activeNodes,i=e.setActiveNodes,o=e.active,s=e.setActive,u=e.selectedProjectId,c=e.mapCoords,v=(0,d.I)(),p=(0,a.useRef)(null),h=(0,a.useState)({x:0,y:0}),f=(0,r.Z)(h,2),m=f[0],g=f[1],x=(0,a.useState)({width:0,height:0}),j=(0,r.Z)(x,2),w=j[0],y=j[1],b=(0,a.useState)(),Z=(0,r.Z)(b,2),k=Z[0],N=Z[1];(0,a.useEffect)((function(){var e,n,t,i=null===p||void 0===p||null===(e=p.current)||void 0===e?void 0:e.getBoundingClientRect();g({x:i?i.width/10:0,y:i?i.width/3:0}),y({width:null!==(n=null===i||void 0===i?void 0:i.width)&&void 0!==n?n:0,height:null!==(t=null===i||void 0===i?void 0:i.height)&&void 0!==t?t:0}),N({})}),[o]);var C=function(e){i&&i((function(n){return(0,l.Z)((0,l.Z)({},n),e)}))},S=function(e){s&&s(e),i&&i({}),N({})};return(0,q.jsxs)("div",{id:"d3-tree-project",style:{height:"100%",width:"100%",overflow:"auto"},ref:p,children:[(0,q.jsx)(re(),{data:n,orientation:"horizontal",translate:m,renderCustomNodeElement:function(e){var n,i,l,r=e.nodeDatum,a=e.toggleNode,s=(0,oe.Z)(e,Se);return(0,q.jsx)(Ne,{nodeDatum:r,toggleNode:a,activeNodes:t,setActive:S,d3ExtraProps:s,addParentsToActivePath:C,active:null===o||void 0===o||null===(n=o.data)||void 0===n||null===(i=n.attributes)||void 0===i||null===(l=i.id)||void 0===l?void 0:l.toString(),setEmptyNodePlacement:N})},pathClassFunc:function(e){var n,i,l,r,a,s,d,u,c,v,p,h,f,m,g,x,j,w=e.source,y=e.target;return"empty"===(null===y||void 0===y||null===(n=y.data)||void 0===n||null===(i=n.attributes)||void 0===i?void 0:i.nodeType)?(null===o||void 0===o||null===(m=o.data)||void 0===m||null===(g=m.attributes)||void 0===g?void 0:g.id)===(null===w||void 0===w||null===(x=w.data)||void 0===x||null===(j=x.attributes)||void 0===j?void 0:j.id)?"node-link to-empty":"empty-link":!t||(null===(l=t[null===y||void 0===y||null===(s=y.data)||void 0===s||null===(d=s.attributes)||void 0===d?void 0:d.id])||void 0===l||null===(r=l.data)||void 0===r||null===(a=r.attributes)||void 0===a?void 0:a.id)!==(null===y||void 0===y||null===(u=y.data)||void 0===u||null===(c=u.attributes)||void 0===c?void 0:c.id)&&(null===o||void 0===o||null===(v=o.data)||void 0===v||null===(p=v.attributes)||void 0===p?void 0:p.id)!==(null===y||void 0===y||null===(h=y.data)||void 0===h||null===(f=h.attributes)||void 0===f?void 0:f.id)?"node-link":"node-link to-active"},collapsible:!1,depthFactor:0,dimensions:w,separation:{siblings:.5}}),(null===k||void 0===k?void 0:k.showForm)&&(0,q.jsx)(Ce,{mapCoords:c,placement:k,onSubmit:function(e){var n,t,i,o;null!==k&&void 0!==k&&null!==(n=k.node)&&void 0!==n&&n.parent?v((0,te.VR)({id:u,node:e})):v(D({description:null!==(t=e.description)&&void 0!==t?t:"",latitude:null!==(i=e.latitude)&&void 0!==i?i:0,longitude:null!==(o=e.longitude)&&void 0!==o?o:0,name:e.name})).unwrap().then((function(e){return v((0,_.B)(e))}));N({})},onClose:function(){return N({})}})]})};var Ae=t.p+"static/media/search-black.d9666e6d4103062e194c9e0c886e8e91.svg";var De=t.p+"static/media/filter.e1bc3dbd425be94f328d303dfce58414.svg";var _e=t.p+"static/media/chevron-left.895bf471dad3151ce05565b8b1439242.svg",Le=function(e){var n=e.title,t=e.search;return(0,q.jsxs)("div",{className:"card-head",children:[(0,q.jsxs)("div",{className:"card-f-row",children:[(0,q.jsx)("b",{children:n}),(0,q.jsxs)("div",{className:"card-filter",children:[(0,q.jsx)("u",{children:"Trier et filtrer"}),(0,q.jsx)("img",{src:De}),(0,q.jsx)("img",{src:Ae})]})]}),(0,q.jsxs)("div",{className:"card-search",children:[(0,q.jsxs)("div",{className:"navigate",children:[(0,q.jsx)("div",{className:"black-round",children:(0,q.jsx)("img",{src:_e})}),(0,q.jsx)("div",{className:"black-round",children:(0,q.jsx)("img",{src:_e})})]}),"string"===typeof t?(0,q.jsx)(U.Z,{type:"card-header",title:t,doThings:function(){return console.log()}}):t]}),(0,q.jsx)("div",{className:"break"})]})},Re=function(e){var n,t,r=e.active,a=e.activeNodes,s=e.setActive,d=e.projects,u=e.selectedProjectId,c=e.setSelectedProjectId,v=e.setActiveNodes,p=Object.values((0,l.Z)((0,l.Z)({},a),{},(0,o.Z)({},null===r||void 0===r||null===(n=r.data)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.id,r))).sort(M.ow),h=function(e){var n,t;return e===(null===r||void 0===r||null===(n=r.data)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.id)||a&&"undefined"!==typeof a[e]},f=p.length>0&&p[0],m=(null===d||void 0===d?void 0:d.length)>0?d.filter((function(e){return!(null!==e&&void 0!==e&&e.parentId)})):[],g=f?"Explorer":"Mes projets",x=function(e){e.stopPropagation(),s&&s(null),v&&v({})};return(0,q.jsx)("div",{tabIndex:0,role:"button",onKeyDown:function(e){var n;"backspace"===(null===e||void 0===e||null===(n=e.key)||void 0===n?void 0:n.toLowerCase())&&s&&s(null===r||void 0===r?void 0:r.parent)},className:"explorer-0o87uu no-padding",children:f?p.map((function(e,n){var t,i,o,l,r,a=null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t.filter((function(e){var n,t;return"empty"!==(null===e||void 0===e||null===(n=e.data)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.nodeType)}));return(0,q.jsxs)("div",{tabIndex:0,role:"button",className:"explore-bread-crumbs-0r",children:[(0,q.jsx)("span",{className:"separator-arrow-p",children:n>0?">":""}),(0,q.jsxs)("div",{tabIndex:0,role:"button",className:"explorer-crumb-0ijf4",onClick:function(){return n=e,void(s&&s(n));var n},children:[0===n?(0,q.jsx)("button",{className:"explore-close-icon",onClick:x,children:"--"}):null,null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.name,a&&(null===a||void 0===a?void 0:a.length)>0?(0,q.jsxs)(q.Fragment,{children:[n===p.length-1?(0,q.jsx)("svg",{width:"20px",height:"20px",viewBox:"0 0 20 20",focusable:"false",fill:"#000000",children:(0,q.jsx)("polygon",{points:"5,8 10,13 15,8"})}):null,(0,q.jsx)("div",{className:"explorer-dropdown-m3uu",children:a.map((function(e){var n,t,i,o,l,r,a,d,u;return(0,q.jsx)("button",{type:"button",title:null===e||void 0===e||null===(n=e.data)||void 0===n||null===(t=n.attributes)||void 0===t||null===(i=t.description)||void 0===i?void 0:i.toString(),className:"explorer-dropdown-m3uu-it3m ".concat(h(null===e||void 0===e||null===(o=e.data)||void 0===o||null===(l=o.attributes)||void 0===l?void 0:l.id)?"active":""),onClick:function(n){return function(e,n){e.stopPropagation(),s&&s(n)}(n,e)},children:null===e||void 0===e||null===(u=e.data)||void 0===u?void 0:u.name},null===e||void 0===e||null===(r=e.data)||void 0===r||null===(a=r.attributes)||void 0===a||null===(d=a.id)||void 0===d?void 0:d.toString())}))})]}):null]})]},null===e||void 0===e||null===(i=e.data)||void 0===i||null===(o=i.attributes)||void 0===o||null===(l=o.id)||void 0===l?void 0:l.toString())})):(0,q.jsx)("div",{className:"explore-search-project-09",children:(0,q.jsxs)("div",{tabIndex:0,role:"button",className:"explore-search-button-div",children:[g,m?(0,q.jsx)("div",{className:"explorer-proj-dropdown-m3uu",children:[].concat((0,i.Z)(m),[{id:"new-project",name:"Nouveau projet",description:"Nouveau projet"}]).map((function(e){var n;return(0,q.jsx)("button",{type:"button",title:e.description,className:"explorer-proj-dropdown-m3uu-it3m ".concat((null===(n=e.id)||void 0===n?void 0:n.toString())===(null===u||void 0===u?void 0:u.toString())?"active":""),onClick:function(){return n=e.id,void c(n);var n},children:e.name},e.id)}))}):null]})})})},Ve=t(8009),Te={label:"empty",id:0,iconName:"placeholder"};var Ie=function(e){var n=e.favs,t=n.length>=10?n:[].concat((0,i.Z)(n),(0,i.Z)(Array(10-n.length).fill(Te).map((function(e,n){return(0,l.Z)((0,l.Z)({},e),{},{id:e.label+n})}))));return(0,q.jsxs)("div",{className:"fav-block-container-0i",children:[(0,q.jsx)("div",{className:"fav-block-title",children:"Favoris"}),(0,q.jsx)("div",{className:"fav-blocks",children:t.map((function(e){return(0,q.jsx)("button",{className:"fav-btn ".concat(e.label),type:"button",children:"empty"===e.label?"+":e.label},e.id)}))})]})},Fe=t(3174),Pe=t(4483),ze=t(1058),Me=function(e){var n=e.project,t=(0,d.I)(),o=(0,a.useState)([]),l=(0,r.Z)(o,2),s=l[0],u=l[1],c=(0,a.useState)(!1),v=(0,r.Z)(c,2),p=v[0],h=v[1],f=(0,a.useState)(!1),m=(0,r.Z)(f,2),g=m[0],x=m[1],j=(0,a.useState)(""),w=(0,r.Z)(j,2),y=w[0],b=w[1];(0,a.useEffect)((function(){h(!1)}),[y]),(0,a.useEffect)((function(){x(!1)}),[s]);var Z=function(e,n){var t=(0,i.Z)(s);t[n].roleId=parseInt(e.target.id),u(t),console.log(s)};function k(){t((0,ne.Wx)("Dashboard")),t((0,ne.eU)(!1))}return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("div",{className:"pop-in_background"}),(0,q.jsxs)("div",{className:"pop-in",children:[(0,q.jsxs)("div",{className:"pop-in_container",children:[(0,q.jsx)("p",{className:"title",children:"Inviter des participants"}),(0,q.jsx)("p",{className:"subtitle",children:"Cette \xe9tape vous permet d'inviter des utilisateurs \xe0 rejoindre ce projet."}),(0,q.jsxs)("div",{className:"content",children:[(0,q.jsxs)("div",{className:"input-container",children:[(0,q.jsx)("input",{type:"text",required:!0,value:y,onChange:function(e){return b(e.target.value)},onKeyPress:function(e){!function(e,n){"Enter"===e.code&&(new RegExp("[a-z0-9]+@[a-z]+.[a-z]{2,3}").test(n)?(s.push({email:n,roleId:""}),b("")):h(!0))}(e,e.currentTarget.value)}}),p&&(0,q.jsx)("p",{className:"errorMsg-popin",children:"L'email n'est pas valide"}),g&&(0,q.jsx)("p",{className:"errorMsg-popin",children:"Selectionnez des droits pour chaques participants"}),(0,q.jsx)("span",{children:"Saisir le mail"})]}),(0,q.jsx)("div",{className:"mail-container",children:s.length>0&&s.map((function(e,n){return(0,q.jsxs)("fieldset",{className:"email-line",children:[(0,q.jsx)("div",{className:"email",onClick:function(){!function(e){var n=(0,i.Z)(s);n.splice(e,1),u(n)}(n)},children:(0,q.jsx)("span",{children:e.email})}),(0,q.jsxs)("div",{className:"radio-btn",children:[(0,q.jsx)("input",{name:e.email,type:"radio",id:"1",onClick:function(e){Z(e,n)}}),(0,q.jsx)("span",{children:"Administrateur"})]}),(0,q.jsxs)("div",{className:"radio-btn",children:[(0,q.jsx)("input",{name:e.email,type:"radio",id:"2",onClick:function(e){Z(e,n)}}),(0,q.jsx)("span",{children:"Membre"})]}),(0,q.jsxs)("div",{className:"radio-btn",children:[(0,q.jsx)("input",{name:e.email,type:"radio",id:"3",onClick:function(e){Z(e,n)}}),(0,q.jsx)("span",{children:"Observateur"})]})]},n)}))}),(0,q.jsx)(U.Z,{type:"submit",light:!0,title:"B\xe2tir ensemble",doThings:function(){var e=!0;s.map((function(n){""===n.roleId&&(e=!1)})),e&&s.length>0?(console.log("send mail"),t((0,ze.Y)({invitations:{invitations:s},id:n})),k()):(x(!0),console.log("dont send mail"))},iconName:Fe.yOZ})]})]}),(0,q.jsx)("div",{children:(0,q.jsx)("div",{className:"pop-in_goback",onClick:function(){return k()},children:(0,q.jsx)(Pe.G,{icon:Fe.NBC,className:"icon_center"})})})]})]})},Be=["children"],Oe=function(e){var n=e.children,t=(0,oe.Z)(e,Be);return(0,q.jsx)("tr",(0,l.Z)((0,l.Z)({},t),{},{children:n}))},qe=["data","meta","treeMeta","newColumn","newRow","appendColums"],He=function(e){var n=e.data,t=e.meta,o=e.treeMeta,a=e.newColumn,s=e.newRow,d=e.appendColums,u=(0,oe.Z)(e,qe),c=function(e){return"string"===typeof e?e:null},v={};(null===n||void 0===n?void 0:n.length)>0&&n.forEach((function(e){var n,t,i,o;null!==(n=e.tree)&&void 0!==n&&null!==(t=n.children)&&void 0!==t&&t.length&&(null===e||void 0===e||null===(i=e.tree)||void 0===i||null===(o=i.children)||void 0===o||o.forEach((function(e){e.name&&(v[e.name]=e)})))}));var p=[].concat((0,i.Z)(Object.keys((0,l.Z)((0,l.Z)({},null!==t&&void 0!==t?t:{}),null!==v&&void 0!==v?v:{}))),(0,i.Z)(d),["empty"]);return(null===n||void 0===n?void 0:n.length)>0?(0,q.jsx)("div",(0,l.Z)((0,l.Z)({},u),{},{style:{maxWidth:"100vw",overflow:"auto",maxHeight:"20vh",overflowY:"auto"},children:(0,q.jsxs)("table",{className:"project-table",style:{borderCollapse:"collapse",borderRadius:5},children:[(0,q.jsx)("thead",{children:(0,q.jsx)(Oe,{children:(0,q.jsxs)(q.Fragment,{children:[Object.entries(t).map((function(e){var n,t=(0,r.Z)(e,2),i=t[0],o=t[1];return(0,q.jsx)("th",{children:null!==(n=o.displayName)&&void 0!==n?n:i},i)})),Object.keys(v).map((function(e){return(0,q.jsx)("th",{style:{textTransform:"capitalize"},children:e},e)})),d.map((function(e){return(0,q.jsx)("th",{style:{textTransform:"capitalize"},children:e},e)})),(0,q.jsx)("th",{style:{textAlign:"center"},children:a.renderHeader()})]})})}),(0,q.jsxs)("tbody",{children:[n.map((function(e,n){var i;return(0,q.jsxs)("tr",{id:null===e||void 0===e||null===(i=e.id)||void 0===i?void 0:i.toString(),onKeyDown:function(n){var t;return function(e,n){var t,i,o,l=document.getElementById(e);null!==n&&void 0!==n&&n.key&&"enter"===(null===n||void 0===n||null===(t=n.key)||void 0===t?void 0:t.toLowerCase())&&l&&(null===l||void 0===l||null===(i=l.nextElementSibling)||void 0===i||null===(o=i.querySelector("input:not(:read-only)"))||void 0===o||o.focus())}(null===e||void 0===e||null===(t=e.id)||void 0===t?void 0:t.toString(),n)},children:[Object.entries(t).map((function(t){var i=(0,r.Z)(t,2),o=i[0],l=i[1];return(0,q.jsx)("td",{children:l.render?l.render(e,n):c(e[o])},o)})),Object.values(v).map((function(t){var i,l,r;if(null!==e&&void 0!==e&&null!==(i=e.tree)&&void 0!==i&&i.children&&(null===e||void 0===e||null===(l=e.tree)||void 0===l?void 0:l.children.length)>1){var a,s,d,u,c=null===e||void 0===e||null===(a=e.tree)||void 0===a||null===(s=a.children)||void 0===s?void 0:s.find((function(e){return e.name===(null===t||void 0===t?void 0:t.name)}));return c?(0,q.jsx)("td",{"data-key":c.name+e.id,children:null===(d=o.status)||void 0===d?void 0:d.render(e,c,n)},c.name+e.id):(0,q.jsx)("td",{children:null===(u=o.none)||void 0===u?void 0:u.render(e,t,n)},e.id+(null===t||void 0===t?void 0:t.name))}return(0,q.jsx)("td",{children:null===(r=o.none)||void 0===r?void 0:r.render(e,t,n)},e.id+(null===t||void 0===t?void 0:t.name))})),d.map((function(t){var i;return(0,q.jsx)("td",{children:null===(i=o.none)||void 0===i?void 0:i.render(e,{name:t},n)},e.id+t)})),(0,q.jsx)("td",{children:a.renderData(n)},e.id+"new")]},e.id)})),s&&(0,q.jsx)("tr",{children:p.map((function(e,n){return(0,q.jsx)("td",{children:s.render(e,n,p.length)},e)}))})]}),(0,q.jsx)("tfoot",{children:(0,q.jsx)("tr",{children:p.map((function(e,n){return(0,q.jsx)("td",{children:(0,q.jsx)("span",{style:{visibility:"hidden",display:"flex"},children:"h"})},e)}))})})]})})):null},Ue=t(5897),Ge=function(e){var n=e.progress,t=e.color;return(0,q.jsx)("div",{className:"simple-progress-xx",style:{border:"1px solid ".concat(null!==t&&void 0!==t?t:"#295EA7")},children:(0,q.jsx)("span",{style:{width:"".concat(n>100?n%100:n,"%"),backgroundColor:null!==t&&void 0!==t?t:"#295EA7"},children:(0,q.jsxs)("span",{style:{fontSize:10,width:"auto"},children:[n,"%"]})})})},We=t(5530),Ke=["onEnter","style","className","onBlur","defaultValue","readonly"],Ye=function(e){var n=e.onEnter,t=e.style,i=e.className,o=e.onBlur,r=e.defaultValue,a=e.readonly,s=(0,oe.Z)(e,Ke);return(0,q.jsx)("input",(0,l.Z)((0,l.Z)({style:(0,l.Z)((0,l.Z)({},{width:"100%",background:"transparent",border:"none",borderBottom:"1px solid transparent",outline:"none",margin:0,lineHeight:"inherit",fontFamily:"inherit",fontSize:"inherit"}),null!==t&&void 0!==t?t:{}),onKeyDown:function(e){var t,i,o=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value;(null===o||void 0===o?void 0:o.toString())!==(null===r||void 0===r?void 0:r.toString())&&(null!==e&&void 0!==e&&e.key&&"enter"===(null===e||void 0===e||null===(i=e.key)||void 0===i?void 0:i.toLowerCase())&&n&&n(o))},onBlur:function(e){var n,t,i=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value;o&&(null===i||void 0===i?void 0:i.toString())!==(null===r||void 0===r?void 0:r.toString())&&o(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)},defaultValue:r,readOnly:a},s),{},{className:"editable-cell-sb ".concat(null!==i&&void 0!==i?i:"")}))},$e=["onChange","onEnter","style","className","options","selected","color","editable"],Qe=function(e){var n,t=e.onChange,i=(e.onEnter,e.style),o=e.className,s=e.options,d=e.selected,u=e.color,c=e.editable,v=(0,oe.Z)(e,$e),p=(0,Ue.$)().t,h=null===s||void 0===s?void 0:s.find((function(e){return(null===e||void 0===e?void 0:e.label)===d})),f=(0,a.useState)(!1),m=(0,r.Z)(f,2),g=m[0],x=m[1],j=(0,a.useState)(""),w=(0,r.Z)(j,2),y=w[0],b=w[1];return(0,q.jsxs)("div",(0,l.Z)((0,l.Z)({style:(0,l.Z)((0,l.Z)({},{width:"100%",background:null!==u&&void 0!==u?u:"transparent",border:"none",outline:"none",margin:0,lineHeight:"inherit",fontFamily:"inherit",fontSize:"inherit",position:"relative"}),null!==i&&void 0!==i?i:{})},v),{},{className:"dropdown-select-cell-sb ".concat(null!==o&&void 0!==o?o:""),children:[(0,q.jsx)("input",{style:{width:"100%",background:"transparent",border:"none",outline:"none",margin:0,lineHeight:"inherit",fontFamily:"inherit",fontSize:"inherit",position:"relative",cursor:"pointer"},className:"dropdown-select-cell-input",value:y||p(null!==(n=null===h||void 0===h?void 0:h.label)&&void 0!==n?n:""),onChange:function(e){var n;return b(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)},onFocus:function(){return x(!0)},readOnly:!c,onBlur:function(){setTimeout((function(){return x(!1)}),100)}}),(null===s||void 0===s?void 0:s.length)>0&&g&&(0,q.jsx)("ul",{className:"dropdown-select-list-group-sb",children:null===s||void 0===s?void 0:s.map((function(e){var n,i,o;return(0,q.jsx)("li",{style:{background:null!==(n=(0,M.lR)(null===e||void 0===e?void 0:e.label).color)&&void 0!==n?n:"#fff"},value:null!==(i=null===e||void 0===e?void 0:e.id)&&void 0!==i?i:null===e||void 0===e?void 0:e.label,className:"dropdown-select-list-item-sb ".concat((null===h||void 0===h?void 0:h.label)===(null===e||void 0===e?void 0:e.label)||(null===h||void 0===h?void 0:h.id)===(null===e||void 0===e?void 0:e.id)?"selected":""),children:(0,q.jsx)("button",{className:"dropdown-select-button",onClick:function(){var n;return function(e){t(e)}(null!==(n=null===e||void 0===e?void 0:e.label)&&void 0!==n?n:null===e||void 0===e?void 0:e.id)},children:p(null!==(o=null===e||void 0===e?void 0:e.label)&&void 0!==o?o:"")})},(null===e||void 0===e?void 0:e.label)+(null===e||void 0===e?void 0:e.id))}))})]}))},Je=t(7637),Xe=t(6336),en=t(128),nn=t(4569),tn=t.n(nn),on=function(e){(0,a.useRef)();var n=(0,d.I)(),t=(0,a.useState)(!1),i=(0,r.Z)(t,2),o=i[0],l=i[1],s=(0,d.v)((function(e){return e.forge})),u=(0,d.v)((function(e){return e.urn.urn})),c=(0,d.v)((function(e){return e.urn_load.response.content})),v=(0,d.v)((function(e){return e.nodeData})),p=3e3;(0,a.useEffect)((function(){n((0,Xe.pO)())}),[]);(0,a.useEffect)((function(){"success"!==(null===c||void 0===c?void 0:c.status)?u.length>0&&setTimeout((function(){n((0,Xe.CZ)(u)),p+=1500}),p):l(!0)}),[c]);return(0,q.jsx)("div",{className:"adsk-viewing-viewer overlay-map",children:function(){var t;if((null===(t=s.response.content)||void 0===t?void 0:t.access_token.length)>0){var i,l,r;if(e.has_urn&&null!=v.response.content)return(0,q.jsx)(en.Z,{version:"6.0",expiresAt:3599,token:null===(i=s.response.content)||void 0===i?void 0:i.access_token,urn:v.response.content.data,headless:!1,onSelectedGuid:""});if(!(u.length>0))return(0,q.jsx)("input",{className:"center-input",type:"file",name:"upload",onChange:function(t){return function(t){if(t.target.files[0]){var i=new FormData;i.append("file",t.target.files[0]),tn().post("http://localhost:8080/api/v1/public/forge/upload/"+e.nodeId,i).then((function(e){"success"===e.data.content.result&&(n((0,Xe.ie)(e.data.content.urn)),n((0,Xe.CZ)(e.data.content.urn)))}))}}(t)}});if(!o&&u.length>0)return(0,q.jsx)("p",{className:"center-input",children:null===c||void 0===c?void 0:c.status});if(null!==(l=s.response.content)&&void 0!==l&&l.access_token&&u.length>0&&o)return(0,q.jsx)(en.Z,{version:"6.0",expiresAt:3599,token:null===(r=s.response.content)||void 0===r?void 0:r.access_token,urn:u,headless:!1,onSelectedGuid:""})}}()})},ln=function(){var e,n,t,u=(0,d.I)(),c=(0,d.v)((function(e){return e})),v=c.projects,p=c.knowledgeTree,h=c.projectNodeTypes,f=c.projectNodeStatuses,m=c.mapMeta,g=(0,d.v)((function(e){return e.nodeData})),x=(0,d.v)((function(e){return e.pages.selected_tab})),j=(0,d.v)((function(e){return e.pages.map_view})),w=(0,a.useState)({}),y=(0,r.Z)(w,2),b=y[0],Z=y[1],k=(0,a.useState)(""),N=(0,r.Z)(k,2),C=N[0],S=N[1],E=(0,a.useState)(!1),A=(0,r.Z)(E,2),D=A[0],L=A[1],R=(0,a.useState)(),V=(0,r.Z)(R,2),T=V[0],I=V[1],F=(0,a.useState)(M.Z),P=(0,r.Z)(F,2),z=P[0],O=P[1],H=(0,a.useState)(),U=(0,r.Z)(H,2),G=U[0],W=U[1],K=(0,a.useState)(),Y=(0,r.Z)(K,2),$=Y[0],Q=Y[1],J=(0,a.useState)(),ee=(0,r.Z)(J,2),oe=ee[0],le=ee[1],re=(0,a.useState)(!1),ae=(0,r.Z)(re,2),se=ae[0],de=ae[1],ue=(0,a.useState)(""),ce=(0,r.Z)(ue,2),ve=ce[0],pe=ce[1],he=(0,a.useState)(!1),fe=(0,r.Z)(he,2),me=fe[0],ge=fe[1],xe=(0,a.useState)([]),je=(0,r.Z)(xe,2),we=je[0],ye=je[1],be=(0,Ue.$)().t,Ze=function(e){p.payload&&u((0,ne.fR)({is_active:e,name:p.payload.name}))};(0,a.useEffect)((function(){u((0,s.w)()),u((0,_.mW)()),u((0,Ve.y)($)),u((0,Je.N)($))}),[]),(0,a.useEffect)((function(){var e;!v.isLoading&&v.payload&&(W(v.payload),(null===v||void 0===v||null===(e=v.payload)||void 0===e?void 0:e.length)>0&&Q((function(e){var n;return e||(null===v||void 0===v||null===(n=v.payload[0])||void 0===n?void 0:n.id)})))}),[v]),(0,a.useEffect)((function(){$&&("new-project"!==$?u((0,te.AV)($)):O(M.Z))}),[$]),(0,a.useEffect)((function(){!p.isLoading&&p.payload&&O(p.payload)}),[p]),(0,a.useEffect)((function(){if("undefined"!==typeof T&&null!==T){u((0,ne.aH)(!0));for(var e=T,n={};null!==e&&void 0!==e;){var t,i,r,a,s,d,c,v,p,h,f,m,g,x,j,w;if(null!==(t=e)&&void 0!==t&&null!==(i=t.data)&&void 0!==i&&null!==(r=i.attributes)&&void 0!==r&&r.id&&null!==(a=e)&&void 0!==a&&null!==(s=a.parent)&&void 0!==s&&null!==(d=s.data)&&void 0!==d&&null!==(c=d.attributes)&&void 0!==c&&c.id)ke(e),n=(0,l.Z)((0,l.Z)({},n),{},(w={},(0,o.Z)(w,null===(p=e)||void 0===p||null===(h=p.parent)||void 0===h||null===(f=h.data)||void 0===f||null===(m=f.attributes)||void 0===m?void 0:m.id,e.parent),(0,o.Z)(w,null===(g=e)||void 0===g||null===(x=g.data)||void 0===x||null===(j=x.attributes)||void 0===j?void 0:j.id,e),w));e=null===(v=e)||void 0===v?void 0:v.parent}Z(n),Ze(!0)}else Ze(!1)}),[T]);var ke=function(e){S(e.data.attributes.id.toString()),"ifc"===e.data.attributes.nodeType?(u((0,Xe.v7)(e.data.attributes.id.toString())),u((0,ne.aH)(!1))):"ifc"!==e.data.attributes.nodeType&&u((0,ne.aH)(!0))};(0,a.useEffect)((function(){console.log(j)}),[j]),(0,a.useEffect)((function(){g.response.errors.length>0?L(!1):null!=g.response.content&&L(!0)}),[g]);var Ne=function(e){null!==e&&void 0!==e&&e.trim()&&(ye([].concat((0,i.Z)(we),[e])),pe("")),de(!1)},Ce=function(e){var n=e.id,t=e.node;u((0,te.sU)({id:n,node:t}))},Se=function(e){pe(e),de(!1)},Ae=function(){ge(!0),u((0,X.eW)("create_project"))};return(0,q.jsxs)(q.Fragment,{children:["Invitation"===x&&(0,q.jsx)(Me,{project:$}),(0,q.jsxs)("div",{className:"dashboard-layout",children:[(0,q.jsxs)("div",{className:"explorer",children:[(0,q.jsx)(Le,{title:"Explorer",search:(0,q.jsx)(Re,{active:T,activeNodes:b,setActive:I,setActiveNodes:Z,projects:G,selectedProjectId:$,setSelectedProjectId:Q})}),(0,q.jsx)(Ie,{favs:null!==(e=h.payload)&&void 0!==e?e:[]}),(0,q.jsx)("div",{className:"canvas-explorer",children:(0,q.jsx)(Ee,{active:T,treeData:z,activeNodes:b,setActive:I,setActiveNodes:Z,selectedProjectId:$,mapCoords:oe})})]}),(0,q.jsxs)("div",{className:"project",children:[(0,q.jsx)(Le,{title:"Contextualiser (".concat(null!==T&&void 0!==T&&null!==(n=T.data)&&void 0!==n&&n.name?null===T||void 0===T||null===(t=T.data)||void 0===t?void 0:t.name:"Mes projets",")"),search:"Carte"}),(0,q.jsxs)("div",{className:"map-container",children:[(0,q.jsx)(ie,{onPin:le,pins:G}),!j&&(0,q.jsx)(on,{has_urn:D,nodeId:C})]}),(null===G||void 0===G?void 0:G.length)>0?(0,q.jsx)(He,{id:"project-data-table-10x",data:(0,i.Z)(G).sort(M.R1),meta:{name:{displayName:be("project-name"),render:function(e,n){return(0,q.jsx)("div",{style:{padding:0,background:"#fff",borderTopLeftRadius:0===n?5:0,borderTopRightRadius:0===n?5:0},children:(0,q.jsx)(Ye,{style:{textAlign:"right"},onEnter:function(n){return function(e){var n=e.id,t=e.node;u((0,_.ty)({id:n,node:t}))}({id:e.id,node:{name:n}})},defaultValue:e.name})})}},creator:{displayName:be("project-manager"),render:function(e,n){var t,i,o,l;return(0,q.jsx)("div",{style:{padding:"0 5px",background:"#fff",borderTopLeftRadius:0===n?5:0,borderTopRightRadius:0===n?5:0},title:"".concat(null!==(t=e.creator.firstName)&&void 0!==t?t:""," ").concat(null!==(i=e.creator.lastName)&&void 0!==i?i:""),children:(0,q.jsx)(Ye,{readonly:!0,style:{textAlign:"right"},onEnter:function(e){return console.log(e)},defaultValue:"".concat(null!==(o=e.creator.firstName)&&void 0!==o?o:""," ").concat(null!==(l=e.creator.lastName)&&void 0!==l?l:"")})})}},progression:{displayName:be("progression"),render:function(e,n){return(0,q.jsx)("div",{style:{display:"flex",background:"#fff",borderBottom:"2px solid #fff",borderTopLeftRadius:0===n?5:0,borderTopRightRadius:0===n?5:0},children:(0,q.jsx)(Ge,{color:"#ED6E40",progress:50})})}},status:{displayName:be("status"),render:function(e){var n,t,i,o=(0,M.lR)(null!==e&&void 0!==e&&e.tree?null===e||void 0===e||null===(n=e.tree)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.status:null===e||void 0===e||null===(i=e.attributes)||void 0===i?void 0:i.status);return(0,q.jsx)(Qe,{options:f.payload,selected:o.status,onChange:function(n){var t,i;return Ce({id:e.id,node:{id:null===e||void 0===e||null===(t=e.tree)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.id,status:n}})},color:o.color})}}},treeMeta:{status:{render:function(e,n){var t,i,o,l=(0,M.lR)(null!==n&&void 0!==n&&n.tree?null===n||void 0===n||null===(t=n.tree)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.status:null===n||void 0===n||null===(o=n.attributes)||void 0===o?void 0:o.status);return(0,q.jsx)(Qe,{options:f.payload,selected:l.status,onChange:function(t){var i;return Ce({id:e.id,node:{id:null===n||void 0===n||null===(i=n.attributes)||void 0===i?void 0:i.id,status:t}})},color:l.color})}},none:{render:function(e,n){return(0,q.jsx)(We.Z,{style:{height:20,width:20},onClick:function(){return function(e){var n,t,o,l=e.id,r=e.node;u((0,te.VR)({id:l,node:{description:null===r||void 0===r||null===(n=r.attributes)||void 0===n?void 0:n.description,name:null===r||void 0===r?void 0:r.name,nodeType:null!==(t=null===r||void 0===r||null===(o=r.attributes)||void 0===o?void 0:o.nodeType)&&void 0!==t?t:"libre"}})).unwrap().then((function(){var e=null===we||void 0===we?void 0:we.findIndex((function(e){return e===r.name}));if(console.log("AA",{newColumns:we,idx:e,node:r}),e>-1){var n=(0,i.Z)(we);n.splice(e,1),ye(n)}}))}({id:e.id,node:n})}})}}},newColumn:{renderData:function(e){return(0,q.jsx)("div",{style:{display:"flex",background:"#fff",borderTopLeftRadius:0===e?5:0,borderTopRightRadius:0===e?5:0},children:(0,q.jsx)(Ye,{readonly:!0})})},renderHeader:function(){return se?(0,q.jsx)(Ye,{autoFocus:!0,style:{textAlign:"right"},onBlur:Se,onEnter:Ne,defaultValue:ve}):(0,q.jsx)(We.Z,{style:{height:20,width:20},onClick:function(){return de(!0)}})}},newRow:{render:function(e,n,t){return(0,q.jsx)("div",{style:{display:"flex",background:"#fff",borderBottomLeftRadius:0===n?5:0,borderBottomRightRadius:n===t-1?5:0},children:0===n?(0,q.jsx)("span",{style:{padding:"0 10px"},title:be("use-map-to-select-location"),children:(0,q.jsx)(We.Z,{style:{height:20,width:20,marginTop:-5},onClick:Ae})}):(0,q.jsx)("span",{style:{visibility:"hidden"},children:"h"})})}},appendColums:we}):null,me?(0,q.jsxs)(B.Z,{show:me,el:"#project-data-table-10x",container:"#project-data-table-10x",onDismiss:function(){u((0,X.xZ)("create_project")),ge(!1)},children:[(0,q.jsx)("code",{children:m.selection.description}),(0,q.jsx)("blockquote",{children:be("use-map-to-select-location")})]}):null]})]})]})}},128:function(e,n,t){var i=t(5671),o=t(3144),l=t(7326),r=t(136),a=t(4062),s=t(2791),d=t(9054),u=t(184),c=function(e){(0,r.Z)(t,e);var n=(0,a.Z)(t);function t(e){var o;return(0,i.Z)(this,t),(o=n.call(this,e)).getForgeToken=function(){return{access_token:o.props.token,expires_in:3599,token_type:"Bearer"}},o.handleTokenRequested=function(e){if(console.log("Token requested by the viewer."),e){var n=o.getForgeToken();console.log("Token : "+n.access_token),n&&e(n.access_token,n.expires_in)}},o.handleDocumentLoaded=function(e,n){0===n.length?console.error("Document contains no viewables."):(console.log("handleDocumentLoaded:",n[0]),o.setViews(n),o.forceUpdate())},o.onSelectionEvent=function(e){var n=(0,l.Z)(o),t=(o.viewer.getSelection(),n.viewer.model.getData().instanceTree);if(1===e.dbIdArray.length){for(var i=e.dbIdArray[0],r=[i];i;)i=t.getNodeParentId(i),r.push(i);n.viewer.model.getBulkProperties(r,["GUID"],(function(e){if(e&&e.length>0){var t=e[0].properties[0].displayValue;console.log("GUID!!!!"),n.props.onSelectedGuid(t)}}))}},o.docs=[],o.views={},o.state={enable:!1,error:!1,empty:!0},o.viewerDiv=s.createRef(),o.viewer=null,o.resizeHandling=null,"undefined"!==typeof e.urn&&""!==e.urn&&o.docs.push(e.urn),o.state={dimensions:{width:-1,height:-1}},o}return(0,o.Z)(t,[{key:"componentDidMount",value:function(){console.log("Comp model"),this.handleScriptLoad.bind(this),this.handleScriptLoad()}},{key:"componentWillUnmount",value:function(){console.log("React Forge Viewer unmounting..."),this.viewer&&(this.viewer.removeEventListener(window.Autodesk.Viewing.SELECTION_CHANGED_EVENT,this.onSelectionEvent),this.viewer.tearDown(),this.viewer.finish(),this.viewer=null,console.log("React Forge Viewer destroyed."))}},{key:"handleLoadModelSuccess",value:function(e){console.log(window.Autodesk.Viewing),console.log("Model successfully loaded by Forge Viewer.",e),this.props.onModelLoad&&this.props.onModelLoad(this.viewer,e)}},{key:"handleLoadModelError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge model - errorCode:"+e),this.props.onModelError&&this.props.onModelError(e)}},{key:"handleViewerError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge Viewer. - errorCode:",e),this.props.onViewerError&&this.props.onViewerError(e)}},{key:"handleScriptLoad",value:function(){console.log("Autodesk scripts have finished loading.");var e={env:"AutodeskProduction",getAccessToken:this.handleTokenRequested};window.Autodesk.Viewing.Initializer(e,this.handleViewerInit.bind(this))}},{key:"handleViewerInit",value:function(){console.log("Forge Viewer has finished initializing."),this.props.proxy&&window.Autodesk.Viewing.endpoint.setEndpointAndApi(this.props.proxy,"derivativeV2");var e=this.viewerDiv.current;this.props.headless?this.viewer=new window.Autodesk.Viewing.Viewer3D(e):this.viewer=new window.Autodesk.Viewing.Private.GuiViewer3D(e),console.log("Starting the Forge Viewer...");var n=this.viewer.start();n?(console.error("Error starting Forge Viewer - code:",n),this.handleViewerError(n)):(console.log("Forge Viewer has successfully started."),this.setState({enable:!0}),this.reviewDocuments()),this.viewer.addEventListener(window.Autodesk.Viewing.SELECTION_CHANGED_EVENT,this.onSelectionEvent)}},{key:"handleLoadDocumentSuccess",value:function(e){console.log("Forge viewer has successfully loaded document:",e);var n=e.getRoot().search({type:"geometry"},!0);n.forEach((function(n){n.doc=e})),this.handleDocumentLoaded(e,n)}},{key:"handleLoadDocumentError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge document - errorCode:"+e),this.props.onDocumentError&&this.props.onDocumentError(e)}},{key:"clearErrors",value:function(){this.setState({error:!1})}},{key:"clearViews",value:function(){this.views={},this.viewer&&(this.viewer.tearDown(),this.viewer.start())}},{key:"reviewDocuments",value:function(){var e=this;if(this.viewer){this.clearErrors(),console.log("reviewing documents...");Object.keys(this.docs);this.setState({empty:0===this.docs.length}),this.docs.forEach((function(n){e.loadDocument(n)}))}}},{key:"loadDocument",value:function(e){console.log("Forge Viewer is loading document:",e);var n="urn:".concat(e),t=this.handleLoadDocumentSuccess.bind(this),i=this.handleLoadDocumentError.bind(this);window.Autodesk.Viewing.Document.load(n,t,i)}},{key:"loadView",value:function(e){console.log("loading view:",e.guid),this.views[e.viewableID]=e;var n=e.doc.getViewablePath(e),t=this.handleLoadModelSuccess.bind(this),i=this.handleLoadModelError.bind(this),o={sharedPropertyDbPath:e.doc.getFullPath()};this.viewer.loadModel(n,o,t,i)}},{key:"isArrayDifferent",value:function(e,n){if(null==e&&null==n)return!1;if(null==e||null==n)return!0;if(e.length!==n.length)return!0;for(var t=0;t<e.length;t++)if(e[t]!==n[t])return!0;return!1}},{key:"shouldComponentUpdateURN",value:function(e,n){this.clearViews(),!e.urn||""===e.urn||"undefined"===typeof e.urn||Array.isArray(e.urn)&&0===e.urn.length?this.docs.length>0&&this.setDocuments([]):Array.isArray(e.urn)?this.isArrayDifferent(this.props.urn,e.urn)&&this.setDocuments(e.urn):e.urn!==this.props.urn?(this.setDocuments([e.urn]),this.loadDocument([e.urn])):this.loadDocument([e.urn])}},{key:"shouldComponentUpdateView",value:function(e,n){!e.view||"undefined"===typeof e.view||Array.isArray(e.view)&&0===e.view.length?Object.keys(this.views).length>0&&this.clearViews():Array.isArray(e.view)?this.isArrayDifferent(this.props.view,e.view)&&this.setViews(e.view):this.props.view!==e.view&&this.setViews([e.view])}},{key:"shouldComponentUpdate",value:function(e,n){return this.shouldComponentUpdateURN(e,n),this.shouldComponentUpdateView(e,n),!0}},{key:"setDocuments",value:function(e){this.docs=e,this.clearViews(),this.reviewDocuments()}},{key:"setViews",value:function(e){var n=this,t=Object.assign({},this.views),i=[];e.forEach((function(e){t.hasOwnProperty(e.viewableID)?delete t[e.viewableID]:i.push(e)})),Object.keys(t).length>0?(this.viewer.tearDown(),this.viewer.start(),e.forEach((function(e){n.loadView(e)}))):i.forEach((function(e){n.loadView(e)}))}},{key:"handleResize",value:function(e){var n=this;this.setState({dimensions:e.bounds}),this.resizeHandling&&clearTimeout(this.resizeHandling),this.resizeHandling=setTimeout((function(){n.viewer&&n.viewer.resize()}),100)}},{key:"render",value:function(){var e=this;return(0,u.jsx)(d.Z,{bounds:!0,onResize:this.handleResize.bind(this),children:function(n){var t=n.measureRef;return(0,u.jsxs)("div",{ref:t,className:"ForgeViewerContainer",children:[(0,u.jsx)("div",{ref:e.viewerDiv,className:"ForgeViewer",style:{height:e.state.dimensions.height}}),e.state.empty&&(0,u.jsx)("div",{className:"scrim",children:(0,u.jsx)("div",{className:"message",children:(0,u.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,u.jsx)("path",{d:"M12.89 1.45l8 4A2 2 0 0 1 22 7.24v9.53a2 2 0 0 1-1.11 1.79l-8 4a2 2 0 0 1-1.79 0l-8-4a2 2 0 0 1-1.1-1.8V7.24a2 2 0 0 1 1.11-1.79l8-4a2 2 0 0 1 1.78 0z"}),(0,u.jsx)("polyline",{points:"2.32 6.16 12 11 21.68 6.16"}),(0,u.jsx)("line",{x1:"12",y1:"22.76",x2:"12",y2:"11"})]})})}),e.state.error&&(0,u.jsx)("div",{className:"scrim",children:(0,u.jsxs)("div",{className:"message",children:[(0,u.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,u.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,u.jsx)("line",{x1:"12",y1:"16",x2:"12",y2:"16"})]}),(0,u.jsx)("div",{children:"Viewer Error"})]})}),!e.state.enable&&(0,u.jsx)("div",{className:"scrim",children:(0,u.jsxs)("div",{className:"message",children:[(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,u.jsx)("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),(0,u.jsx)("div",{children:"Starting Viewer..."})]})})]})}})}}]),t}(s.Component);n.Z=c}}]);
//# sourceMappingURL=862.7235db76.chunk.js.map