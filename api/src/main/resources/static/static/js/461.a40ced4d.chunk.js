"use strict";(self.webpackChunkstartbuilding=self.webpackChunkstartbuilding||[]).push([[461],{128:function(e,n,i){var t=i(5671),o=i(3144),r=i(7326),s=i(136),l=i(4062),a=i(2791),d=i(9054),u=i(184),c=function(e){(0,s.Z)(i,e);var n=(0,l.Z)(i);function i(e){var o;return(0,t.Z)(this,i),(o=n.call(this,e)).getForgeToken=function(){return{access_token:o.props.token,expires_in:3599,token_type:"Bearer"}},o.handleTokenRequested=function(e){if(console.log("Token requested by the viewer."),e){var n=o.getForgeToken();console.log("Token : "+n.access_token),n&&e(n.access_token,n.expires_in)}},o.handleDocumentLoaded=function(e,n){0===n.length?console.error("Document contains no viewables."):(console.log("handleDocumentLoaded:",n[0]),o.setViews(n),o.forceUpdate())},o.onSelectionEvent=function(e){var n=(0,r.Z)(o),i=(o.viewer.getSelection(),n.viewer.model.getData().instanceTree);if(1===e.dbIdArray.length){for(var t=e.dbIdArray[0],s=[t];t;)t=i.getNodeParentId(t),s.push(t);n.viewer.model.getBulkProperties(s,["GUID"],(function(e){if(e&&e.length>0){var i=e[0].properties[0].displayValue;console.log("GUID!!!!"),n.props.onSelectedGuid(i)}}))}},o.docs=[],o.views={},o.state={enable:!1,error:!1,empty:!0},o.viewerDiv=a.createRef(),o.viewer=null,o.resizeHandling=null,"undefined"!==typeof e.urn&&""!==e.urn&&o.docs.push(e.urn),o.state={dimensions:{width:-1,height:-1}},o}return(0,o.Z)(i,[{key:"componentDidMount",value:function(){console.log("Comp model"),this.handleScriptLoad.bind(this),this.handleScriptLoad()}},{key:"componentWillUnmount",value:function(){console.log("React Forge Viewer unmounting..."),this.viewer&&(this.viewer.removeEventListener(window.Autodesk.Viewing.SELECTION_CHANGED_EVENT,this.onSelectionEvent),this.viewer.tearDown(),this.viewer.finish(),this.viewer=null,console.log("React Forge Viewer destroyed."))}},{key:"handleLoadModelSuccess",value:function(e){console.log(window.Autodesk.Viewing),console.log("Model successfully loaded by Forge Viewer.",e),this.props.onModelLoad&&this.props.onModelLoad(this.viewer,e)}},{key:"handleLoadModelError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge model - errorCode:"+e),this.props.onModelError&&this.props.onModelError(e)}},{key:"handleViewerError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge Viewer. - errorCode:",e),this.props.onViewerError&&this.props.onViewerError(e)}},{key:"handleScriptLoad",value:function(){console.log("Autodesk scripts have finished loading.");var e={env:"AutodeskProduction",getAccessToken:this.handleTokenRequested};window.Autodesk.Viewing.Initializer(e,this.handleViewerInit.bind(this))}},{key:"handleViewerInit",value:function(){console.log("Forge Viewer has finished initializing."),this.props.proxy&&window.Autodesk.Viewing.endpoint.setEndpointAndApi(this.props.proxy,"derivativeV2");var e=this.viewerDiv.current;this.props.headless?this.viewer=new window.Autodesk.Viewing.Viewer3D(e):this.viewer=new window.Autodesk.Viewing.Private.GuiViewer3D(e),console.log("Starting the Forge Viewer...");var n=this.viewer.start();n?(console.error("Error starting Forge Viewer - code:",n),this.handleViewerError(n)):(console.log("Forge Viewer has successfully started."),this.setState({enable:!0}),this.reviewDocuments()),this.viewer.addEventListener(window.Autodesk.Viewing.SELECTION_CHANGED_EVENT,this.onSelectionEvent)}},{key:"handleLoadDocumentSuccess",value:function(e){console.log("Forge viewer has successfully loaded document:",e);var n=e.getRoot().search({type:"geometry"},!0);n.forEach((function(n){n.doc=e})),this.handleDocumentLoaded(e,n)}},{key:"handleLoadDocumentError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge document - errorCode:"+e),this.props.onDocumentError&&this.props.onDocumentError(e)}},{key:"clearErrors",value:function(){this.setState({error:!1})}},{key:"clearViews",value:function(){this.views={},this.viewer&&(this.viewer.tearDown(),this.viewer.start())}},{key:"reviewDocuments",value:function(){var e=this;if(this.viewer){this.clearErrors(),console.log("reviewing documents...");Object.keys(this.docs);this.setState({empty:0===this.docs.length}),this.docs.forEach((function(n){e.loadDocument(n)}))}}},{key:"loadDocument",value:function(e){console.log("Forge Viewer is loading document:",e);var n="urn:".concat(e),i=this.handleLoadDocumentSuccess.bind(this),t=this.handleLoadDocumentError.bind(this);window.Autodesk.Viewing.Document.load(n,i,t)}},{key:"loadView",value:function(e){console.log("loading view:",e.guid),this.views[e.viewableID]=e;var n=e.doc.getViewablePath(e),i=this.handleLoadModelSuccess.bind(this),t=this.handleLoadModelError.bind(this),o={sharedPropertyDbPath:e.doc.getFullPath()};this.viewer.loadModel(n,o,i,t)}},{key:"isArrayDifferent",value:function(e,n){if(null==e&&null==n)return!1;if(null==e||null==n)return!0;if(e.length!==n.length)return!0;for(var i=0;i<e.length;i++)if(e[i]!==n[i])return!0;return!1}},{key:"shouldComponentUpdateURN",value:function(e,n){this.clearViews(),!e.urn||""===e.urn||"undefined"===typeof e.urn||Array.isArray(e.urn)&&0===e.urn.length?this.docs.length>0&&this.setDocuments([]):Array.isArray(e.urn)?this.isArrayDifferent(this.props.urn,e.urn)&&this.setDocuments(e.urn):e.urn!==this.props.urn?(this.setDocuments([e.urn]),this.loadDocument([e.urn])):this.loadDocument([e.urn])}},{key:"shouldComponentUpdateView",value:function(e,n){!e.view||"undefined"===typeof e.view||Array.isArray(e.view)&&0===e.view.length?Object.keys(this.views).length>0&&this.clearViews():Array.isArray(e.view)?this.isArrayDifferent(this.props.view,e.view)&&this.setViews(e.view):this.props.view!==e.view&&this.setViews([e.view])}},{key:"shouldComponentUpdate",value:function(e,n){return this.shouldComponentUpdateURN(e,n),this.shouldComponentUpdateView(e,n),!0}},{key:"setDocuments",value:function(e){this.docs=e,this.clearViews(),this.reviewDocuments()}},{key:"setViews",value:function(e){var n=this,i=Object.assign({},this.views),t=[];e.forEach((function(e){i.hasOwnProperty(e.viewableID)?delete i[e.viewableID]:t.push(e)})),Object.keys(i).length>0?(this.viewer.tearDown(),this.viewer.start(),e.forEach((function(e){n.loadView(e)}))):t.forEach((function(e){n.loadView(e)}))}},{key:"handleResize",value:function(e){var n=this;this.setState({dimensions:e.bounds}),this.resizeHandling&&clearTimeout(this.resizeHandling),this.resizeHandling=setTimeout((function(){n.viewer&&n.viewer.resize()}),100)}},{key:"render",value:function(){var e=this;return(0,u.jsx)(d.Z,{bounds:!0,onResize:this.handleResize.bind(this),children:function(n){var i=n.measureRef;return(0,u.jsxs)("div",{ref:i,className:"ForgeViewerContainer",children:[(0,u.jsx)("div",{ref:e.viewerDiv,className:"ForgeViewer",style:{height:e.state.dimensions.height}}),e.state.empty&&(0,u.jsx)("div",{className:"scrim",children:(0,u.jsx)("div",{className:"message",children:(0,u.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,u.jsx)("path",{d:"M12.89 1.45l8 4A2 2 0 0 1 22 7.24v9.53a2 2 0 0 1-1.11 1.79l-8 4a2 2 0 0 1-1.79 0l-8-4a2 2 0 0 1-1.1-1.8V7.24a2 2 0 0 1 1.11-1.79l8-4a2 2 0 0 1 1.78 0z"}),(0,u.jsx)("polyline",{points:"2.32 6.16 12 11 21.68 6.16"}),(0,u.jsx)("line",{x1:"12",y1:"22.76",x2:"12",y2:"11"})]})})}),e.state.error&&(0,u.jsx)("div",{className:"scrim",children:(0,u.jsxs)("div",{className:"message",children:[(0,u.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,u.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,u.jsx)("line",{x1:"12",y1:"16",x2:"12",y2:"16"})]}),(0,u.jsx)("div",{children:"Viewer Error"})]})}),!e.state.enable&&(0,u.jsx)("div",{className:"scrim",children:(0,u.jsxs)("div",{className:"message",children:[(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,u.jsx)("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),(0,u.jsx)("div",{children:"Starting Viewer..."})]})})]})}})}}]),i}(a.Component);n.Z=c},7461:function(e,n,i){i.r(n),i.d(n,{default:function(){return c}});var t=i(9439),o=i(2791),r=i(5405),s=i(6336),l=i(128),a=i(4569),d=i.n(a),u=i(184),c=function(){var e,n,i=(0,o.useRef)(),a=(0,r.I)(),c=(0,o.useState)(!1),h=(0,t.Z)(c,2),v=h[0],w=h[1],g=(0,r.v)((function(e){return e.forge})),p=(0,r.v)((function(e){return e.urn.urn})),f=(0,r.v)((function(e){return e.urn_load.response.content})),m=3e3;(0,o.useEffect)((function(){a((0,s.pO)())}),[]);return(0,o.useEffect)((function(){"success"!==(null===f||void 0===f?void 0:f.status)?p.length>0&&setTimeout((function(){a((0,s.CZ)(p)),m+=1500}),m):w(!0)}),[f]),(0,u.jsx)("div",{className:"profil_layout",children:(0,u.jsxs)("div",{className:"profil-container",ref:i,children:[!(p.length>0)&&(0,u.jsx)("input",{type:"file",name:"upload",onChange:function(e){return function(e){if(e.target.files[0]){var n=new FormData;n.append("file",e.target.files[0]),d().post("http://localhost:8080/api/v1/public/forge/upload",n).then((function(e){"success"===e.data.content.result&&(a((0,s.ie)(e.data.content.urn)),a((0,s.CZ)(e.data.content.urn)))}))}}(e)}}),!v&&p.length>0&&(0,u.jsx)("p",{children:null===f||void 0===f?void 0:f.status}),(null===(e=g.response.content)||void 0===e?void 0:e.access_token)&&p.length>0&&v&&(0,u.jsx)(l.Z,{version:"6.0",expiresAt:3599,token:null===(n=g.response.content)||void 0===n?void 0:n.access_token,urn:p,headless:!1,onSelectedGuid:""})]})})}}}]);
//# sourceMappingURL=461.a40ced4d.chunk.js.map