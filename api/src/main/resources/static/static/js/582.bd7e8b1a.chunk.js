"use strict";(self.webpackChunkstartbuilding=self.webpackChunkstartbuilding||[]).push([[582],{6549:function(e,n,t){t(2791);n.Z=t.p+"static/media/apple.7f266128e9ea9928775383a0a3930d6e.svg"},8006:function(e,n,t){t(2791);n.Z=t.p+"static/media/google.b58ffc002585a28021a00030f4b2a965.svg"},4947:function(e,n,t){t(2791);n.Z=t.p+"static/media/linkedin.7ec10e715d53d7e7f09b2649e06a1294.svg"},1977:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ln}});var i=t(3433),o=t(4942),l=t(1413),r=t(9439),d=t(2791),a=t(9421),u=t(5405),s=t(5861),c=t(7757),v=t.n(c),f=(t(4847),t(5936)),p=t(7707),h=t(430),m=t(2532),g=t(8976),x=t(6588),j=t(7726),b=t(1358),y=t(2652),w=t(8153),Z=t(5397);var N=t.p+"static/media/orange.08ed0737daabcf34240f2a28402d80e9.svg";var k=t.p+"static/media/blue.18e2e570f303f3c69fadb17f6507ed87.svg";var C={orange:N,blue:k,yellow:t.p+"static/media/yellow.95f3abb3465d6d410ba85571b2c9482f.svg"};var S=t.p+"static/media/drawable.e28d4a0198e43cb720feecf652f5a7ed.svg",E=t(8258),A=t(4431),R=(0,E.hg)("createProject",function(){var e=(0,s.Z)(v().mark((function e(n,t){var i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.Z.createProject(n);case 2:return i=e.sent,e.abrupt("return",null===i||void 0===i?void 0:i.content);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()),I=((0,E.oM)({name:"authSlice",initialState:{isLoading:!1,payload:{code:"",content:{description:"",latitude:0,longitude:0,name:""},errors:[],warnings:[]}},reducers:{},extraReducers:function(e){e.addCase(R.pending,(function(e){e.isLoading=!0})),e.addCase(R.fulfilled,(function(e,n){return{payload:n.payload,isLoading:!1}})),e.addCase(R.rejected,(function(e,n){e.isLoading=!1}))}}),t(2183)),D=t(7447),L=t(9409),_=t(8676),T=t(6252),V=t(9236),F=t(927),B=t(6233),P=t(7867),M=t(5850),z=t(6739),O=t(6089),U=(t(4929),t(184));var H=function(e){var n=e.options,t=e.name,i=e.title,o=(e.checked,e.type),r=void 0===o?"checkbox":o,d=e.onChange,a=null!==t&&void 0!==t?t:(Math.random()*Date.now()).toString(),u=function(e,t){var i=(0,l.Z)((0,l.Z)({},t),{},{checked:e.target.checked});"function"===typeof d&&d({target:i,selection:n.map((function(e){var n,t;return(null===(n=i.value)||void 0===n?void 0:n.toString())===(null===(t=e.value)||void 0===t?void 0:t.toString())?i:"radio"===r?(0,l.Z)((0,l.Z)({},e),{},{checked:!1}):e}))})};return n.length>0?(0,U.jsxs)("fieldset",{className:"inline-select-fieldset",children:[i?(0,U.jsx)("legend",{children:i}):null,(0,U.jsx)("div",{className:"options-container",children:n.map((function(e){return(0,U.jsxs)("label",{title:e.description,children:[(0,U.jsx)("input",{onChange:function(n){return u(n,e)},name:a,type:r,defaultChecked:e.checked}),e.label]},e.value)}))})]}):null},q=t(6618);var W=function(e){var n=e.onNext,t=e.entrance,i=e.exit,o=e.projectData,l=(0,d.useState)(""),a=(0,r.Z)(l,2),u=a[0],s=a[1],c=(0,d.useState)(""),v=(0,r.Z)(c,2),f=v[0],p=v[1],h=(0,d.useState)(""),m=(0,r.Z)(h,2),g=m[0],x=m[1],j=(0,d.useState)(""),b=(0,r.Z)(j,2),y=b[0],w=b[1],Z=(0,d.useState)(!0),N=(0,r.Z)(Z,2),k=N[0],C=N[1];return(0,d.useEffect)((function(){var e,n,t,i;s(null!==(e=null===o||void 0===o?void 0:o.name)&&void 0!==e?e:""),p(null!==(n=null===o||void 0===o?void 0:o.description)&&void 0!==n?n:""),x(null!==(t=null===o||void 0===o?void 0:o.contractor)&&void 0!==t?t:""),w(null!==(i=null===o||void 0===o?void 0:o.contractorEmail)&&void 0!==i?i:"")}),[]),(0,U.jsxs)("div",{className:"proj-screen__container ".concat(t?"entrance":""," ").concat(i?"exit":""),children:[(0,U.jsx)("h3",{className:"proj-screen__title",children:"Parlez nous de votre projet"}),(0,U.jsx)(q.Z,{required:!0,value:u,onChange:function(e){return s(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Nom du projet"}),(0,U.jsx)(q.Z,{required:!0,value:f,onChange:function(e){return p(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"D\xe9crivez le en une phrase"}),(0,U.jsx)(H,{options:[{label:"Oui",value:1,checked:!0},{label:"Non",value:0}],title:"Serez vous le ma\xeetre d\u2019ouvrage du projet?",type:"radio",checked:0,onChange:function(e){return C(1===e.target.value)}}),k?null:(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(q.Z,{value:g,onChange:function(e){return x(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Nom de la Ma\xeetrise d\u2019ouvrage"}),(0,U.jsx)(q.Z,{value:y,onChange:function(e){return w(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Adresse mail du Ma\xeetre d\u2019ouvrage",type:"email"})]}),(0,U.jsx)(O.Z,{onClick:function(){""!==u.trim()&&""!==f.trim()&&n({name:u,description:f,contractor:g,contractorEmail:y})},round:!0,btnClassName:"proj-continue-btn",icon:(0,U.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",style:{transform:"rotate(175deg)"},children:(0,U.jsx)("path",{id:"Fl\xe8che-chevron-s",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})}),children:"Continuer"})]})};var G=function(e){var n=e.onNext,t=e.onSave,i=e.entrance,o=e.exit,l=e.projectData,a=(0,d.useState)(""),u=(0,r.Z)(a,2),s=u[0],c=u[1],v=(0,d.useState)(""),f=(0,r.Z)(v,2),p=f[0],h=f[1],m=(0,d.useState)(""),g=(0,r.Z)(m,2),x=g[0],j=g[1],b=(0,d.useState)(""),y=(0,r.Z)(b,2),w=y[0],Z=y[1];return(0,d.useEffect)((function(){var e,n,t,i;c(null!==(e=null===l||void 0===l?void 0:l.workType)&&void 0!==e?e:""),h(null!==(n=null===l||void 0===l?void 0:l.marketType)&&void 0!==n?n:""),j(null!==(t=null===l||void 0===l?void 0:l.team)&&void 0!==t?t:""),Z(null!==(i=null===l||void 0===l?void 0:l.teamRoleId)&&void 0!==i?i:"")}),[]),(0,U.jsxs)("div",{className:"proj-screen__container ".concat(i?"entrance":""," ").concat(o?"exit":""),children:[(0,U.jsx)("h3",{className:"proj-screen__title",children:"Dites nous en plus"}),(0,U.jsx)("h5",{className:"proj-screen__title",children:"sur votre projet"}),(0,U.jsx)(q.Z,{value:s,onChange:function(e){return c(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Typologie de l\u2019ouvrage"}),(0,U.jsx)(q.Z,{value:p,onChange:function(e){return h(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Type de march\xe9"}),(0,U.jsx)("h5",{className:"proj-screen__title",children:"sur vous"}),(0,U.jsx)(q.Z,{value:x,onChange:function(e){return j(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Dans quelle \xe9quipe intervenez-vous?"}),(0,U.jsx)(q.Z,{value:w,onChange:function(e){return Z(null===e||void 0===e?void 0:e.target.value)},containerClassName:"proj-screen__input",title:"Quel sera votre r\xf4le au sein de l\u2019\xe9quipe?"}),(0,U.jsx)(O.Z,{onClick:function(){n({workType:s,marketType:p,team:x,teamRoleId:w}),t&&t({workType:s,marketType:p,team:x,teamRoleId:w})},round:!0,btnClassName:"proj-continue-btn",icon:(0,U.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",style:{transform:"rotate(175deg)"},children:(0,U.jsx)("path",{id:"Fl\xe8che-chevron-s",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})}),children:"Continuer"})]})},$=t(3895),K=t(5791);var Y=function(e){var n=e.onNext,t=e.entrance,i=e.exit,a=e.roles,u=e.project,s=(0,d.useState)({}),c=(0,r.Z)(s,2),v=c[0],f=c[1],p=(0,d.useState)(""),h=(0,r.Z)(p,2),m=h[0],g=h[1],x=(0,d.useState)(""),j=(0,r.Z)(x,2),b=j[0],y=j[1],w=(0,d.useState)(""),Z=(0,r.Z)(w,2),N=Z[0],k=Z[1],C=function(e){var n;(null!==e&&void 0!==e&&e.key&&"enter"===(null===e||void 0===e||null===(n=e.key)||void 0===n?void 0:n.toLowerCase())||null===e||void 0===e||!e.key)&&M.sC.isEmail(m)&&(f((function(e){return(0,l.Z)((0,l.Z)({},e),{},(0,o.Z)({},m,{email:m,roleId:0,ms:Date.now()}))})),g(""),y(""),k(""))},S=function(e){f((function(n){var t=(0,l.Z)({},n);return delete t[e],t}))},E=function(e,n){return e.ms&&n.ms?e.ms>n.ms?-1:1:-1},A=(0,d.useMemo)((function(){return Object.values(v).sort(E)}),[v]);return(0,U.jsxs)("div",{className:"proj-screen__container ".concat(t?"entrance":""," ").concat(i?"exit":""),children:[(0,U.jsx)("h3",{className:"proj-screen__title",children:"Inviter des participants"}),(0,U.jsx)("h5",{className:"proj-screen__title",children:"Cette \xe9tape vous permet d\u2019inviter des utilisateurs \xe0 rejoindre ce projet."}),(0,U.jsx)(q.Z,{onKeyDown:C,value:m,onChange:function(e){var n;g(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value),b&&y(""),N&&k("")},style:{with:"80%"},containerClassName:"proj-screen__input",title:"Saisir une adresse email",icon:(0,U.jsxs)("svg",{onClick:C,tabIndex:0,role:"button",className:"plus-svg-54",viewBox:"0 0 100 100",fill:"#F3BE3D",children:[(0,U.jsx)("circle",{cx:50,cy:50,r:50}),(0,U.jsx)("text",{textAnchor:"middle",x:50,y:75,fill:"#fff",fontSize:100,children:"+"})]})}),A.length>0?A.map((function(e){return(0,U.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,U.jsx)(K.Z,{value:e.email,onDismiss:S}),(0,U.jsx)(H,{onChange:function(n){return t=n,i=e,void f((function(e){return(0,l.Z)((0,l.Z)({},e),{},(0,o.Z)({},i.email,{email:i.email,roleId:t.target.value,ms:i.ms}))}));var t,i},type:"radio",options:a?a.map((function(e){return{value:e.id,label:e.name,description:e.description}})):[]})]},e.email)})):null,b&&A.length>0?(0,U.jsx)("span",{style:{color:"#E33F1A"},children:b}):null,!b&&N?(0,U.jsx)("span",{style:{color:"#E33F1A"},children:N}):null,(0,U.jsx)(O.Z,{onClick:function(){""!==m&&k("".concat(M.sC.isEmail(m)?"Veuillez appuyer sur Entr\xe9e si vous souhaitez inviter "+m:"email ".concat(m," invalide")));try{Object.values(v).forEach((function(e){if(!e.roleId)throw Error("Veuillez s\xe9lectionner un r\xf4le pour chaque participant")})),null!==u&&void 0!==u&&u.id&&$.Z.sendEmail(u.id,{invitations:Object.values(v)}),""===m&&n({})}catch(t){var e;y(null!==(e=null===t||void 0===t?void 0:t.message)&&void 0!==e?e:"")}},round:!0,btnClassName:"proj-continue-btn",icon:(0,U.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",style:{transform:"rotate(175deg)"},children:(0,U.jsx)("path",{id:"Fl\xe8che-chevron-s",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})}),children:A.length>0?"Inviter ces participants":"Continuer"})]})};var Q=t.p+"static/media/clap.e11804d8958e6b79668b05285348dc58.svg";var J=[W,G,Y,function(e){var n=e.onNext,t=e.entrance,i=e.exit,o=e.onComplete,l="Ce projet est maintenant disponible!";return(0,U.jsxs)("div",{className:"proj-screen__container ".concat(t?"entrance":""," ").concat(i?"exit":""),children:[(0,U.jsx)("h3",{className:"proj-screen__title",children:l}),(0,U.jsx)("h5",{className:"proj-screen__title",children:"Gr\xe2ce \xe0 vous, l\u2019ensemble des acteurs va pouvoir rejoindre ce projet."}),(0,U.jsx)("img",{width:150,src:Q,alt:l}),(0,U.jsx)(O.Z,{onClick:function(){n({}),"function"===typeof o&&o()},round:!0,btnClassName:"proj-continue-btn",icon:(0,U.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",style:{transform:"rotate(175deg)"},children:(0,U.jsx)("path",{id:"Fl\xe8che-chevron-s",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})}),children:"Acc\xe9der au projet"})]})}],X=t(9896);var ee=function(e){var n=e.onDismiss,t=e.onSubmit,i=e.project,o=(0,d.useState)(0),a=(0,r.Z)(o,2),s=a[0],c=a[1],v=(0,d.useState)(!1),f=(0,r.Z)(v,2),p=f[0],h=f[1],m=(0,d.useState)(!1),g=(0,r.Z)(m,2),x=g[0],j=g[1],b=(0,d.useState)({}),y=(0,r.Z)(b,2),w=y[0],Z=y[1],N=(0,d.useState)(),k=(0,r.Z)(N,2),C=k[0],S=k[1],E=(0,u.I)();(0,d.useEffect)((function(){A.Z.getRoleList().then((function(e){return S(e)}))}),[]);var R=(0,d.useMemo)((function(){return J[s]}),[s]),I=function(){E((0,X.xZ)("create_project")),n()};return(0,U.jsxs)("div",{style:{display:"flex",minWidth:"80%"},children:[(0,U.jsx)("div",{style:{flex:2},children:(0,U.jsx)(R,{onSave:function(e){return n=(0,l.Z)((0,l.Z)({},w),e),t&&t(n),void(0,X.xZ)("create_project");var n},onComplete:I,project:i,projectData:w,roles:C,entrance:x,exit:p,onNext:function(e){Z((function(n){return c((function(e){return j(!0),setTimeout((function(){return j(!1)}),300),e<J.length-1?e+1:e})),(0,l.Z)((0,l.Z)({},n),e)}))}})}),(0,U.jsx)("div",{style:{flex:1,display:"flex",justifyContent:"flex-end",alignItems:"flex-start"},children:(0,U.jsxs)("button",{className:"proj-back__btn",onClick:function(){c((function(e){return e>0?(h(!0),setTimeout((function(){return h(!1)}),300),e-1):(I(),0)}))},children:["Retour",(0,U.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",children:(0,U.jsx)("path",{id:"Fl\xe8che",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})})]})})]})},ne=t(215),te=t(5334),ie=function(e){var n,t=(0,d.useState)(!1),i=(0,r.Z)(t,2),o=i[0],a=i[1],c=(0,d.useState)(!1),N=(0,r.Z)(c,2),k=(N[0],N[1],(0,d.useState)("")),E=(0,r.Z)(k,2),A=E[0],O=E[1],H=(0,d.useState)([]),q=(0,r.Z)(H,2),W=q[0],G=q[1],$=(0,d.useState)(),K=(0,r.Z)($,2),Y=K[0],Q=K[1],J=(0,d.useState)(),ie=(0,r.Z)(J,2),oe=ie[0],le=ie[1],re=(0,d.useState)(),de=(0,r.Z)(re,2),ae=de[0],ue=de[1],se=(0,d.useState)(),ce=(0,r.Z)(se,2),ve=ce[0],fe=ce[1],pe=(0,d.useState)(),he=(0,r.Z)(pe,2),me=he[0],ge=he[1],xe=(0,d.useRef)(),je=(0,d.useRef)(),be=(0,d.useRef)(),ye=(0,d.useRef)(),we=(0,d.useRef)();we.current=Y;var Ze=(0,d.useRef)();Ze.current=oe;var Ne=(0,d.useRef)();Ne.current=ae,(0,d.useRef)().current=ve;var ke=(0,u.I)(),Ce=(0,u.v)((function(e){return e.mapMeta})),Se=function(){var e=(0,s.Z)(v().mark((function e(n){var t;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke(R((0,l.Z)((0,l.Z)({},n),{},{longitude:W[0],latitude:W[1]}))).unwrap();case 2:t=e.sent,ke((0,I.B)(t)),ge(t);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Ee=function(){a(!1),ke((0,X.xZ)("create_project"))},Ae=function(n){var t,i=n.coordinate,o=n.pixel,l=null===(t=we.current)||void 0===t?void 0:t.forEachFeatureAtPixel(o,(function(e){return e}));if(l)return ke((0,ne.fR)({is_active:!0,name:l.get("name")})),ke((0,te.AV)(l.get("id"))),void a(!1);var r,d=(0,Z.bU)(i);G(d);var u=(0,w.V7)(d);d.length>1&&(e.onPin&&(e.onPin({longitude:d[0],latitude:d[1]}),a(!0)),ke((0,X.Z5)({longitude:d[0],latitude:d[1],description:u}))),O(u),a(!0),je.current.style.display="block",null===(r=Ze.current)||void 0===r||r.setPosition(i),Ie()},Re=function(e){var n,t=e.coordinate,i=e.pixel;we.current.getTarget().style.cursor="";var o,l=null===(n=we.current)||void 0===n?void 0:n.forEachFeatureAtPixel(i,(function(e){return e}));if(l&&(Ie(),we.current.getTarget().style.cursor="pointer",null===(o=Ne.current)||void 0===o||o.setPosition(t),be.current)){be.current.style="display: flex; flex-direction: column; position: relative; z-index: 20;";var r=l.get("name"),d=l.get("description");be.current.innerHTML="\n                    ".concat(r?"<h5>".concat(r,"</h5>"):"","\n                    ").concat(d?"<p>".concat(d,"</p>"):"","\n                ")}},Ie=function(){be.current&&(be.current.style="display: none;",be.current.innerHTML="")};return(0,d.useEffect)((function(){var e=new b.Z({element:null===je||void 0===je?void 0:je.current,autoPan:{animation:{duration:250}}}),n=new b.Z({element:null===be||void 0===be?void 0:be.current,positioning:"bottom-center",stopEvent:!1}),t=new m.Z,i=new f.Z({target:null===xe||void 0===xe?void 0:xe.current,overlays:[e,n],layers:[new p.Z({source:new g.Z({url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",projection:"EPSG:3857"})}),new D.Z({source:t})],controls:(0,x.ce)().extend([new j.Z]),view:new h.ZP({projection:"EPSG:3857",center:[3,6e6],zoom:5})}),o=new P.Z({source:t});i.addInteraction(o),Q(i),le(e),ue(n),fe(t),i.on("click",Ae),i.on("pointermove",Re),i.on("movestart",Ie)}),[]),(0,d.useEffect)((function(){var n;if(Y&&ve&&ye.current&&e.pins&&(null===(n=e.pins)||void 0===n?void 0:n.length)>0){var t,i={r:237,g:110,b:64},o=(0,M.$h)(S,i);null===(t=e.pins)||void 0===t||t.forEach((function(n,t){var r,d,a,u,s=new y.Z((0,l.Z)({geometry:new L.Z((0,Z.mi)([n.longitude,n.latitude]))},n)),c=new _.ZP({image:new T.Z({anchor:[.5,0],anchorOrigin:"bottom-right",scale:.5,src:C.orange}),text:new V.Z({font:"10px Calibri,sans-serif",fill:new F.Z({color:"rgb(".concat(i.r,",").concat(i.g,",").concat(i.b,")")}),stroke:new B.Z({color:"#fff",width:2}),text:null!==(r=null===(d=(null!==(a=null===(u=e.pins)||void 0===u?void 0:u.length)&&void 0!==a?a:0)-t)||void 0===d?void 0:d.toString())&&void 0!==r?r:"",offsetY:-o.height/3})});s.setStyle(c),null===ve||void 0===ve||ve.addFeature(s)})),je.current.style.display="none"}}),[e.pins,Y]),(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)("div",{ref:xe,className:"map",id:"map",children:[(0,U.jsx)("div",{onClick:function(e){null===e||void 0===e||e.stopPropagation()},ref:be,className:"ol-tool-tip"}),(0,U.jsx)("img",{ref:je,src:C.blue,className:"project-pointer"})]}),(0,U.jsx)("img",{ref:ye,src:S,style:{display:"none"}}),o&&!(null===(n=Ce.activities)||void 0===n||!n.create_project)&&(0,U.jsxs)(z.Z,{show:o,el:"#map",container:".background-layout",onDismiss:Ee,children:[(0,U.jsx)("code",{children:A}),(0,U.jsx)(ee,{project:me,onSubmit:Se,onDismiss:Ee})]})]})},oe=t(5987),le=t(4419),re=t.n(le),de=t(6549),ae=t(3280),ue=t(810),se=t(8006),ce=t(2607),ve=t(4023),fe=t(4947),pe=t(5211);var he=t.p+"static/media/member.fb3513941ba1baf12e08119a7024ab11.svg",me=t(2454);var ge=t.p+"static/media/organisation.efa0cfcf500774d1efcb6b093ef829b9.svg";var xe=t.p+"static/media/pin.d2679618240c8b28773a95afcb281fb5.svg",je=t(3834);var be=t.p+"static/media/plus.8a6a02d7c59802bb732d85e8e550ad63.svg";var ye=t.p+"static/media/question.9b793928a44f6612d3dd1f8c551126cc.svg",we=t(9200),Ze=t(447),Ne={apple:de.Z,projet:ae.Z,dashboard:ue.Z,google:se.Z,home:ce.Z,house:ve.Z,linkedin:fe.Z,mail:pe.Z,equipe:he,notification:me.Z,organisation:ge,pin:xe,plug:je.Z,empty:be,question:ye,search:we.Z,user:Ze.Z,clap:Q};var ke=function(e){var n,t,i,o,l,r,a,u=(0,d.useRef)(null),s=e.nodeDatum,c=e.d3ExtraProps,v=e.setActive,f=e.activeNodes,p=e.active,h=e.setEmptyNodePlacement,m=s.attributes,g=m.id,x=m.nodeType,j=m.iconName,b=f&&f[g],y=p===g,w=c.hierarchyPointNode,Z=(null===w||void 0===w||null===(n=w.parent)||void 0===n||null===(t=n.data)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.id)===p||null===(null===w||void 0===w?void 0:w.parent),N=y?"#295EA7":"#fff",k="empty"===x,C="",S=null!==(o=e.nodeSize)&&void 0!==o?o:52,E=Ne.question;return k&&(N="#F3BE3D"),j in Ne?E=Ne[j]:x in Ne&&(E=Ne[x]),C=b?y?"#555":"#295EA7":"#959595",k&&!Z?null:(0,U.jsxs)("svg",{x:-S/2,y:-S/2,viewBox:"0 0 ".concat(S," ").concat(S),width:S,height:S,onClick:function(e){"function"!==typeof v||k||v(w),h&&k&&h({showForm:!0,node:w,el:null===u||void 0===u?void 0:u.current})},ref:u,children:[(0,U.jsxs)("g",{children:[(0,U.jsx)("circle",{fill:N,cy:S/2,cx:S/2,id:g,r:S/2-(b&&!y?3:0),strokeWidth:b&&!y?3:0,stroke:"#295EA7"}),(0,U.jsx)("image",{viewBox:"0 0 ".concat(S," ").concat(S),x:"25%",y:"25%",xlinkHref:E,width:"50%",height:"50%",preserveAspectRatio:"xMidYMid slice"}),(0,U.jsx)("text",{y:S/2,x:S/2,strokeWidth:0,fontSize:10,fill:C,alignmentBaseline:"middle",textAnchor:"middle",children:(null===s||void 0===s||null===(l=s.name)||void 0===l?void 0:l.length)>9?(null===s||void 0===s||null===(r=s.name)||void 0===r?void 0:r.substring(0,7))+"...":null===s||void 0===s?void 0:s.name})]}),(0,U.jsx)("title",{children:null===(a=s.attributes)||void 0===a?void 0:a.description})]})},Ce=t(663),Se=function(e){var n,t,i,o,l,a,s,c,v,f,p=e.placement,h=e.onSubmit,m=e.mapCoords,g=e.onClose,x=(0,u.v)((function(e){return e.projectNodeTypes})),j=(0,u.I)(),b=null===p||void 0===p||null===(n=p.el)||void 0===n?void 0:n.getBoundingClientRect(),y=(0,d.useState)(""),w=(0,r.Z)(y,2),Z=w[0],N=w[1],k=(0,d.useState)(""),C=(0,r.Z)(k,2),S=C[0],E=C[1],A=(0,d.useState)(""),R=(0,r.Z)(A,2),I=R[0],D=R[1],L=(0,d.useState)(null),_=(0,r.Z)(L,2),T=_[0],V=_[1],F=(0,d.useState)(""),B=(0,r.Z)(F,2),P=(B[0],B[1]);(0,d.useEffect)((function(){var e,n;x.payload&&(null===(e=x.payload)||void 0===e?void 0:e.length)>0&&N(null===x||void 0===x||null===(n=x.payload[0])||void 0===n?void 0:n.id)}),[x]),(0,d.useEffect)((function(){var e;m?V(m):null!==p&&void 0!==p&&p.node&&null===(null===p||void 0===p||null===(e=p.node)||void 0===e?void 0:e.parent)&&(0,M.vW)().then((function(e){return V(null===e||void 0===e?void 0:e.coords)}),(function(e){console.log("error geting position",e),P("Veuillez activer la localisation sur votre navigateur")}))}),[m,p]);return(0,U.jsx)("div",{style:{position:"absolute",top:"".concat(null!==(t=null===b||void 0===b?void 0:b.y)&&void 0!==t?t:0,"px"),left:"".concat(null!==(i=null===b||void 0===b?void 0:b.right)&&void 0!==i?i:0,"px"),zIndex:1100},children:(0,U.jsxs)("div",{className:"placement-form-u0",children:[(0,U.jsx)("button",{className:"placement-close-icon",onClick:function(e){g&&g()},children:(0,U.jsx)("svg",{fill:"#000000",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24px",height:"24px",children:(0,U.jsx)("path",{d:"M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"})})}),(0,U.jsxs)("div",{className:"placement-title",children:["Ajouter un nouveau ",null===(null===p||void 0===p||null===(o=p.node)||void 0===o?void 0:o.parent)?"projet":"n\u0153ud \xe0 ".concat(null===p||void 0===p||null===(l=p.node)||void 0===l||null===(a=l.parent)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.name)]}),null!==(c=p.node)&&void 0!==c&&c.parent&&x&&!x.isLoading&&null!==x&&void 0!==x&&x.payload&&(null===x||void 0===x||null===(v=x.payload)||void 0===v?void 0:v.length)>0?(0,U.jsx)("select",{value:Z,onChange:function(e){var n;return function(e){var n,t=null===x||void 0===x||null===(n=x.payload)||void 0===n?void 0:n.find((function(n){var t;return(null===(t=n.id)||void 0===t?void 0:t.toString())===e}));!t||"model_3d"!==(null===t||void 0===t?void 0:t.label)&&"ifc"!==(null===t||void 0===t?void 0:t.label)?j((0,Ce.BR)("map")):j((0,Ce.BR)("model_3d")),N(e)}(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)},children:x.payload.filter((function(e){return"empty"!==(null===e||void 0===e?void 0:e.label)&&"projet"!==(null===e||void 0===e?void 0:e.label)})).map((function(e){return(0,U.jsx)("option",{value:null===e||void 0===e?void 0:e.id,children:null===e||void 0===e?void 0:e.label},(null===e||void 0===e?void 0:e.id)+(null===e||void 0===e?void 0:e.label))}))}):null,null===(null===p||void 0===p||null===(f=p.node)||void 0===f?void 0:f.parent)?(0,U.jsx)("input",{readOnly:!0,type:"search",placeholder:"Emplacement du projet",value:T?"".concat(null===T||void 0===T?void 0:T.longitude,", ").concat(null===T||void 0===T?void 0:T.longitude):""}):null,(0,U.jsxs)("div",{style:{position:"relative"},children:[(0,U.jsx)("span",{style:{color:"#E33F1A",position:"absolute",left:5,top:"20%"},children:"*"}),(0,U.jsx)("input",{required:!0,style:{paddingLeft:10},placeholder:"nom",value:S,onChange:function(e){var n;return E(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)}})]}),(0,U.jsx)("div",{children:(0,U.jsx)("textarea",{placeholder:"description",value:I,onChange:function(e){var n;return D(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)}})}),(0,U.jsx)("div",{children:(0,U.jsx)("button",{disabled:!(null!==S&&void 0!==S&&S.trim()),onClick:function(){var e,n,t,i;p.node&&S&&h({name:S,typeId:Z,description:I,longitude:null===T||void 0===T?void 0:T.longitude,latitude:null===T||void 0===T?void 0:T.latitude,parentNodeId:null===p||void 0===p||null===(e=p.node)||void 0===e||null===(n=e.parent)||void 0===n||null===(t=n.data)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.id})},children:"Add"})})]})})},Ee=["nodeDatum","toggleNode"],Ae=function(e){var n=e.treeData,t=e.activeNodes,i=e.setActiveNodes,o=e.active,a=e.setActive,s=e.selectedProjectId,c=e.mapCoords,v=(0,u.I)(),f=(0,d.useRef)(null),p=(0,d.useState)({x:0,y:0}),h=(0,r.Z)(p,2),m=h[0],g=h[1],x=(0,d.useState)({width:0,height:0}),j=(0,r.Z)(x,2),b=j[0],y=j[1],w=(0,d.useState)(),Z=(0,r.Z)(w,2),N=Z[0],k=Z[1];(0,d.useEffect)((function(){var e,n,t,i=null===f||void 0===f||null===(e=f.current)||void 0===e?void 0:e.getBoundingClientRect();g({x:i?i.width/10:0,y:i?i.width/3:0}),y({width:null!==(n=null===i||void 0===i?void 0:i.width)&&void 0!==n?n:0,height:null!==(t=null===i||void 0===i?void 0:i.height)&&void 0!==t?t:0}),k({})}),[o]);var C=function(e){i&&i((function(n){return(0,l.Z)((0,l.Z)({},n),e)}))},S=function(e){a&&a(e),i&&i({}),k({})};return(0,U.jsxs)("div",{id:"d3-tree-project",style:{height:"100%",width:"100%",overflow:"auto"},ref:f,children:[(0,U.jsx)(re(),{data:n,orientation:"horizontal",translate:m,renderCustomNodeElement:function(e){var n,i,l,r=e.nodeDatum,d=e.toggleNode,a=(0,oe.Z)(e,Ee);return(0,U.jsx)(ke,{nodeDatum:r,toggleNode:d,activeNodes:t,setActive:S,d3ExtraProps:a,addParentsToActivePath:C,active:null===o||void 0===o||null===(n=o.data)||void 0===n||null===(i=n.attributes)||void 0===i||null===(l=i.id)||void 0===l?void 0:l.toString(),setEmptyNodePlacement:k})},pathClassFunc:function(e){var n,i,l,r,d,a,u,s,c,v,f,p,h,m,g,x,j,b=e.source,y=e.target;return"empty"===(null===y||void 0===y||null===(n=y.data)||void 0===n||null===(i=n.attributes)||void 0===i?void 0:i.nodeType)?(null===o||void 0===o||null===(m=o.data)||void 0===m||null===(g=m.attributes)||void 0===g?void 0:g.id)===(null===b||void 0===b||null===(x=b.data)||void 0===x||null===(j=x.attributes)||void 0===j?void 0:j.id)?"node-link to-empty":"empty-link":!t||(null===(l=t[null===y||void 0===y||null===(a=y.data)||void 0===a||null===(u=a.attributes)||void 0===u?void 0:u.id])||void 0===l||null===(r=l.data)||void 0===r||null===(d=r.attributes)||void 0===d?void 0:d.id)!==(null===y||void 0===y||null===(s=y.data)||void 0===s||null===(c=s.attributes)||void 0===c?void 0:c.id)&&(null===o||void 0===o||null===(v=o.data)||void 0===v||null===(f=v.attributes)||void 0===f?void 0:f.id)!==(null===y||void 0===y||null===(p=y.data)||void 0===p||null===(h=p.attributes)||void 0===h?void 0:h.id)?"node-link":"node-link to-active"},collapsible:!1,depthFactor:0,dimensions:b,separation:{siblings:.5}}),(null===N||void 0===N?void 0:N.showForm)&&(0,U.jsx)(Se,{mapCoords:c,placement:N,onSubmit:function(e){var n,t,i,o;null!==N&&void 0!==N&&null!==(n=N.node)&&void 0!==n&&n.parent?v((0,te.VR)({id:s,node:e})):v(R({description:null!==(t=e.description)&&void 0!==t?t:"",latitude:null!==(i=e.latitude)&&void 0!==i?i:0,longitude:null!==(o=e.longitude)&&void 0!==o?o:0,name:e.name})).unwrap().then((function(e){return v((0,I.B)(e))}));k({})},onClose:function(){return k({})}})]})};var Re=t.p+"static/media/search-black.d9666e6d4103062e194c9e0c886e8e91.svg";var Ie=t.p+"static/media/filter.e1bc3dbd425be94f328d303dfce58414.svg";var De=t.p+"static/media/chevron-left.895bf471dad3151ce05565b8b1439242.svg",Le=function(e){var n=e.title,t=e.search;return(0,U.jsxs)("div",{className:"card-head",children:[(0,U.jsxs)("div",{className:"card-f-row",children:[(0,U.jsx)("b",{children:n}),(0,U.jsxs)("div",{className:"card-filter",children:[(0,U.jsx)("u",{children:"Trier et filtrer"}),(0,U.jsx)("img",{src:Ie}),(0,U.jsx)("img",{src:Re})]})]}),(0,U.jsxs)("div",{className:"card-search",children:[(0,U.jsxs)("div",{className:"navigate",children:[(0,U.jsx)("div",{className:"black-round",children:(0,U.jsx)("img",{src:De})}),(0,U.jsx)("div",{className:"black-round",children:(0,U.jsx)("img",{src:De})})]}),"string"===typeof t?(0,U.jsx)(q.Z,{type:"card-header",title:t,doThings:function(){return console.log()}}):t]}),(0,U.jsx)("div",{className:"break"})]})},_e=function(e){var n,t,r=e.active,d=e.activeNodes,a=e.setActive,u=e.projects,s=e.selectedProjectId,c=e.setSelectedProjectId,v=e.setActiveNodes,f=Object.values((0,l.Z)((0,l.Z)({},d),{},(0,o.Z)({},null===r||void 0===r||null===(n=r.data)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.id,r))).sort(M.ow),p=function(e){var n,t;return e===(null===r||void 0===r||null===(n=r.data)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.id)||d&&"undefined"!==typeof d[e]},h=f.length>0&&f[0],m=(null===u||void 0===u?void 0:u.length)>0?u.filter((function(e){return!(null!==e&&void 0!==e&&e.parentId)})):[],g=h?"Explorer":"Mes projets",x=function(e){e.stopPropagation(),a&&a(null),v&&v({})};return(0,U.jsx)("div",{tabIndex:0,role:"button",onKeyDown:function(e){var n;"backspace"===(null===e||void 0===e||null===(n=e.key)||void 0===n?void 0:n.toLowerCase())&&a&&a(null===r||void 0===r?void 0:r.parent)},className:"explorer-0o87uu no-padding",children:h?f.map((function(e,n){var t,i,o,l,r,d=null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t.filter((function(e){var n,t;return"empty"!==(null===e||void 0===e||null===(n=e.data)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.nodeType)}));return(0,U.jsxs)("div",{tabIndex:0,role:"button",className:"explore-bread-crumbs-0r",children:[(0,U.jsx)("span",{className:"separator-arrow-p",children:n>0?">":""}),(0,U.jsxs)("div",{tabIndex:0,role:"button",className:"explorer-crumb-0ijf4",onClick:function(){return n=e,void(a&&a(n));var n},children:[0===n?(0,U.jsx)("button",{className:"explore-close-icon",onClick:x,children:"--"}):null,null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.name,d&&(null===d||void 0===d?void 0:d.length)>0?(0,U.jsxs)(U.Fragment,{children:[n===f.length-1?(0,U.jsx)("svg",{width:"20px",height:"20px",viewBox:"0 0 20 20",focusable:"false",fill:"#000000",children:(0,U.jsx)("polygon",{points:"5,8 10,13 15,8"})}):null,(0,U.jsx)("div",{className:"explorer-dropdown-m3uu",children:d.map((function(e){var n,t,i,o,l,r,d,u,s;return(0,U.jsx)("button",{type:"button",title:null===e||void 0===e||null===(n=e.data)||void 0===n||null===(t=n.attributes)||void 0===t||null===(i=t.description)||void 0===i?void 0:i.toString(),className:"explorer-dropdown-m3uu-it3m ".concat(p(null===e||void 0===e||null===(o=e.data)||void 0===o||null===(l=o.attributes)||void 0===l?void 0:l.id)?"active":""),onClick:function(n){return function(e,n){e.stopPropagation(),a&&a(n)}(n,e)},children:null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.name},null===e||void 0===e||null===(r=e.data)||void 0===r||null===(d=r.attributes)||void 0===d||null===(u=d.id)||void 0===u?void 0:u.toString())}))})]}):null]})]},null===e||void 0===e||null===(i=e.data)||void 0===i||null===(o=i.attributes)||void 0===o||null===(l=o.id)||void 0===l?void 0:l.toString())})):(0,U.jsx)("div",{className:"explore-search-project-09",children:(0,U.jsxs)("div",{tabIndex:0,role:"button",className:"explore-search-button-div",children:[g,m?(0,U.jsx)("div",{className:"explorer-proj-dropdown-m3uu",children:[].concat((0,i.Z)(m),[{id:"new-project",name:"Nouveau projet",description:"Nouveau projet"}]).map((function(e){var n;return(0,U.jsx)("button",{type:"button",title:e.description,className:"explorer-proj-dropdown-m3uu-it3m ".concat((null===(n=e.id)||void 0===n?void 0:n.toString())===(null===s||void 0===s?void 0:s.toString())?"active":""),onClick:function(){return n=e.id,void c(n);var n},children:e.name},e.id)}))}):null]})})})},Te=t(8009),Ve={label:"empty",id:0,iconName:"placeholder"};var Fe=function(e){var n=e.favs,t=n.length>=10?n:[].concat((0,i.Z)(n),(0,i.Z)(Array(10-n.length).fill(Ve).map((function(e,n){return(0,l.Z)((0,l.Z)({},e),{},{id:e.label+n})}))));return(0,U.jsxs)("div",{className:"fav-block-container-0i",children:[(0,U.jsx)("div",{className:"fav-block-title",children:"Favoris"}),(0,U.jsx)("div",{className:"fav-blocks",children:t.map((function(e){return(0,U.jsx)("button",{className:"fav-btn ".concat(e.label),type:"button",children:"empty"===e.label?"+":e.label},e.id)}))})]})},Be=t(3174),Pe=t(4483),Me=t(1058),ze=function(e){var n=e.project,t=(0,u.I)(),o=(0,d.useState)([]),l=(0,r.Z)(o,2),a=l[0],s=l[1],c=(0,d.useState)(!1),v=(0,r.Z)(c,2),f=v[0],p=v[1],h=(0,d.useState)(!1),m=(0,r.Z)(h,2),g=m[0],x=m[1],j=(0,d.useState)(""),b=(0,r.Z)(j,2),y=b[0],w=b[1];(0,d.useEffect)((function(){p(!1)}),[y]),(0,d.useEffect)((function(){x(!1)}),[a]);var Z=function(e,n){var t=(0,i.Z)(a);t[n].roleId=parseInt(e.target.id),s(t),console.log(a)};function N(){t((0,ne.Wx)("Dashboard")),t((0,ne.eU)(!1))}return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{className:"pop-in_background"}),(0,U.jsxs)("div",{className:"pop-in",children:[(0,U.jsxs)("div",{className:"pop-in_container",children:[(0,U.jsx)("p",{className:"title",children:"Inviter des participants"}),(0,U.jsx)("p",{className:"subtitle",children:"Cette \xe9tape vous permet d'inviter des utilisateurs \xe0 rejoindre ce projet."}),(0,U.jsxs)("div",{className:"content",children:[(0,U.jsxs)("div",{className:"input-container",children:[(0,U.jsx)("input",{type:"text",required:!0,value:y,onChange:function(e){return w(e.target.value)},onKeyPress:function(e){!function(e,n){"Enter"===e.code&&(new RegExp("[a-z0-9]+@[a-z]+.[a-z]{2,3}").test(n)?(a.push({email:n,roleId:""}),w("")):p(!0))}(e,e.currentTarget.value)}}),f&&(0,U.jsx)("p",{className:"errorMsg-popin",children:"L'email n'est pas valide"}),g&&(0,U.jsx)("p",{className:"errorMsg-popin",children:"Selectionnez des droits pour chaques participants"}),(0,U.jsx)("span",{children:"Saisir le mail"})]}),(0,U.jsx)("div",{className:"mail-container",children:a.length>0&&a.map((function(e,n){return(0,U.jsxs)("fieldset",{className:"email-line",children:[(0,U.jsx)("div",{className:"email",onClick:function(){!function(e){var n=(0,i.Z)(a);n.splice(e,1),s(n)}(n)},children:(0,U.jsx)("span",{children:e.email})}),(0,U.jsxs)("div",{className:"radio-btn",children:[(0,U.jsx)("input",{name:e.email,type:"radio",id:"1",onClick:function(e){Z(e,n)}}),(0,U.jsx)("span",{children:"Administrateur"})]}),(0,U.jsxs)("div",{className:"radio-btn",children:[(0,U.jsx)("input",{name:e.email,type:"radio",id:"2",onClick:function(e){Z(e,n)}}),(0,U.jsx)("span",{children:"Membre"})]}),(0,U.jsxs)("div",{className:"radio-btn",children:[(0,U.jsx)("input",{name:e.email,type:"radio",id:"3",onClick:function(e){Z(e,n)}}),(0,U.jsx)("span",{children:"Observateur"})]})]},n)}))}),(0,U.jsx)(q.Z,{type:"submit",light:!0,title:"B\xe2tir ensemble",doThings:function(){var e=!0;a.map((function(n){""===n.roleId&&(e=!1)})),e&&a.length>0?(console.log("send mail"),t((0,Me.Y)({invitations:{invitations:a},id:n})),N()):(x(!0),console.log("dont send mail"))},iconName:Be.yOZ})]})]}),(0,U.jsx)("div",{children:(0,U.jsx)("div",{className:"pop-in_goback",onClick:function(){return N()},children:(0,U.jsx)(Pe.G,{icon:Be.NBC,className:"icon_center"})})})]})]})},Oe=t(5897),Ue=t(7637),He=t(3179),qe=t(5671),We=t(3144),Ge=t(136),$e=t(4062),Ke=function(e){(0,Ge.Z)(t,e);var n=(0,$e.Z)(t);function t(e){var i;return(0,qe.Z)(this,t),(i=n.call(this,e)).state={hasError:!1},i}return(0,We.Z)(t,[{key:"componentDidCatch",value:function(e,n){console.log({error:e,errorInfo:n})}},{key:"render",value:function(){return this.state.hasError?null:this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),t}(d.Component),Ye=function(e){var n,t=e.onChange,i=e.options,o=e.selected,l=(e.activeNode,(0,Oe.$)().t),a=null===i||void 0===i?void 0:i.find((function(e){return(null===e||void 0===e?void 0:e.label)===o})),u=(0,d.useState)(!1),s=(0,r.Z)(u,2),c=s[0],v=s[1];return(0,U.jsxs)("div",{className:"dropdown-common-xx",children:[(0,U.jsx)("span",{tabIndex:0,role:"button",onClick:function(){return v((function(e){return!e}))},children:l(null!==(n=null===a||void 0===a?void 0:a.label)&&void 0!==n?n:"")}),(0,U.jsx)("div",{style:{flex:1,display:"flex",justifyContent:"flex-end",alignItems:"flex-start"},children:(0,U.jsx)("button",{className:"proj-back__btn",onClick:function(){return v((function(e){return!e}))},children:(0,U.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 5.067 8.137",children:(0,U.jsx)("path",{id:"Fl\xe8che",d:"M3.438,2.488,1.2,4.775a.683.683,0,0,1-1,0,.782.782,0,0,1,0-1.055L3.6.2A.581.581,0,0,1,4.033,0h.262A.525.525,0,0,1,4.6.2L7.932,3.795a.782.782,0,0,1,0,1.055.683.683,0,0,1-1,0L4.889,2.639C4.306,2.245,4.053,2.132,3.438,2.488Z",transform:"translate(0 8.137) rotate(-90)",fill:"#fff",fillRule:"evenodd"})})})}),(null===i||void 0===i?void 0:i.length)>0&&c&&(0,U.jsx)("ul",{className:"dropdown-target-container",children:null===i||void 0===i?void 0:i.map((function(e){var n,i;return(0,U.jsx)("li",{value:null!==(n=null===e||void 0===e?void 0:e.id)&&void 0!==n?n:null===e||void 0===e?void 0:e.label,className:"dropdown-list-item-xx ".concat((null===a||void 0===a?void 0:a.label)===(null===e||void 0===e?void 0:e.label)||(null===a||void 0===a?void 0:a.id)===(null===e||void 0===e?void 0:e.id)?"selected":""),children:(0,U.jsx)("button",{className:"dropdown-button-xx",onClick:function(){var n,i;return i=null!==(n=null===e||void 0===e?void 0:e.label)&&void 0!==n?n:null===e||void 0===e?void 0:e.id,t(i),void setTimeout((function(){return v(!1)}),100)},children:l(null!==(i=null===e||void 0===e?void 0:e.label)&&void 0!==i?i:"")})},(null===e||void 0===e?void 0:e.label)+(null===e||void 0===e?void 0:e.id))}))})]})},Qe=t(9909),Je=t(4569),Xe=t.n(Je),en=t(8079);var nn=t.p+"static/media/cloud-upload.d927155858f04d23bb808ca3703f6838.svg",tn=["onChange","nodeName"],on=function(e){var n=e.onChange,t=e.nodeName,i=(0,oe.Z)(e,tn),o=(0,d.useRef)(null),a=(0,d.useState)([]),u=(0,r.Z)(a,2),s=u[0],c=u[1],v=(0,Oe.$)().t;return(0,U.jsxs)("div",{style:{display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"center",height:"100%"},children:[(0,U.jsxs)("div",{style:{minWidth:200,minHeight:200,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",cursor:"pointer"},tabIndex:0,role:"button",onClick:function(){var e;null!==(e=o.current)&&void 0!==e&&e.click&&o.current.click()},children:[(0,U.jsx)("div",{style:{width:100,height:100},children:(0,U.jsx)("img",{width:"100%",height:"100%",style:{cursor:"pointer",objectFit:"contain"},src:nn,alt:""})}),(0,U.jsx)("div",{style:{maxWidth:"30vw",textAlign:"center"},children:s.length>0?(0,U.jsx)("p",{children:s.length>1?s.join(", "):s[0]}):t&&(0,U.jsx)("p",{children:v("upload-file-add-to-project",{name:t})})})]}),(0,U.jsx)("input",(0,l.Z)((0,l.Z)({},i),{},{onChange:function(e){var t;if(n(e),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.files){for(var i=[],o=0;o<(null===e||void 0===e||null===(l=e.target)||void 0===l||null===(r=l.files)||void 0===r?void 0:r.length);o++){var l,r,d,a;i.push(null===e||void 0===e||null===(d=e.target)||void 0===d||null===(a=d.files[o])||void 0===a?void 0:a.name)}c(i)}},type:"file",hidden:!0,ref:o}))]})},ln=t(4849),rn=t(658),dn=function(e){(0,d.useRef)();var n=(0,u.I)(),t=(0,d.useState)(""),i=(0,r.Z)(t,2),o=i[0],l=i[1],a=(0,d.useState)(!1),s=(0,r.Z)(a,2),c=s[0],v=s[1],f=(0,d.useState)(""),p=(0,r.Z)(f,2)[1],h=(0,u.v)((function(e){return e.forge})),m=((0,u.v)((function(e){return e.urn.urn})),(0,u.v)((function(e){return e.urn_load.response.content})),(0,u.v)((function(e){return e.nodeData})),(0,d.useRef)(null)),g=(0,d.useRef)(0),x=(0,Oe.$)().t;(0,d.useEffect)((function(){n((0,He.pO)()),l("")}),[]);var j=function(t){if(t.target.files[0]){var i=new FormData;i.append("file",t.target.files[0]),l(""),v(!1),Xe().post((0,en.iE)().urlHostApi+"/public/forge/upload/"+e.nodeId+"?projectId="+e.projectId,i).then((function(t){"success"===t.data.content.result&&(n((0,He.ie)(t.data.content.urn)),e.projectId&&n((0,te.AV)(e.projectId)),l(t.data.content.urn))}))}},b=function(e){rn.Z.getCheckStatus(e).then((function(e){if(null!==e&&void 0!==e&&e.content){var n=null===e||void 0===e?void 0:e.content,t=n.status,i=n.progress;"success"===t&&(clearInterval(m.current),v(!0)),i&&"inprogress"===t&&p(null===i||void 0===i?void 0:i.substring(0,null===i||void 0===i?void 0:i.indexOf("complete")))}}))};(0,d.useEffect)((function(){var e;o.length>0&&(e=o,clearInterval(m.current),v(!1),e&&(m.current=setInterval((function(){g.current>9&&clearInterval(m.current),g.current=g.current+1,b(e)}),1e4)))}),[o]),(0,d.useEffect)((function(){var n,t,i,o,r;(l(""),v(!1),null!==(n=e.activeNode)&&void 0!==n&&null!==(t=n.attributes)&&void 0!==t&&t.data)&&b(null===(i=e.activeNode)||void 0===i||null===(o=i.attributes)||void 0===o||null===(r=o.data)||void 0===r?void 0:r.toString())}),[e.activeNode]);return(0,U.jsx)("div",{className:"adsk-viewing-viewer overlay-map",children:function(){var n,t,i,l,r,d,a,u,s,v,f;if((null===(n=h.response.content)||void 0===n?void 0:n.access_token.length)>0)return"model_3d"!==(null===(t=e.activeNode)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.nodeType)&&"ifc"!==(null===(l=e.activeNode)||void 0===l||null===(r=l.attributes)||void 0===r?void 0:r.nodeType)||"string"!==typeof(null===(d=e.activeNode)||void 0===d||null===(a=d.attributes)||void 0===a?void 0:a.data)?o.length>0?c?(0,U.jsx)(Qe.Z,{version:"6.0",expiresAt:3599,token:null===(u=h.response.content)||void 0===u?void 0:u.access_token,urn:o,headless:!1,onSelectedGuid:""}):(0,U.jsxs)("div",{style:{height:"100%",width:"100%",margin:"auto",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,U.jsx)(ln.Z,{animation:"grow",variant:"info"}),(0,U.jsx)("span",{style:{textAlign:"center"},children:x("preparing-model-data")})]}):(0,U.jsx)(on,{nodeName:e.nodeName,className:"center-input",name:"upload",onChange:j}):c?(0,U.jsx)(Qe.Z,{version:"6.0",expiresAt:3599,token:null===(s=h.response.content)||void 0===s?void 0:s.access_token,urn:null===(v=e.activeNode)||void 0===v||null===(f=v.attributes)||void 0===f?void 0:f.data,headless:!1,onSelectedGuid:""}):(0,U.jsxs)("div",{style:{height:"100%",width:"100%",margin:"auto",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,U.jsx)(ln.Z,{animation:"grow",variant:"info"}),(0,U.jsx)("span",{style:{textAlign:"center"},children:x("preparing-model-data")})]})}()})},an=t(3816),un=t.n(an),sn=(t(8162),function(e){var n=e.color,t=e.label,i=e.cards,o=(0,Oe.$)().t;return(0,d.useEffect)((function(){var e=document.body.querySelector('div[data-rbd-draggable-id="column-draggable-'.concat(t,'"]'));e&&(e.style.backgroundColor="rgba(".concat(n,", 0.5)"))}),[]),(0,U.jsxs)("div",{id:"kanban-column-header-".concat(t),className:"kanban-colum-header",style:{marginBottom:5,color:"rgb(".concat(n,")"),padding:5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["".concat(o(t)," (").concat(null===i||void 0===i?void 0:i.length,")"),(0,U.jsxs)("button",{style:{backgroundColor:"rgba(".concat(n,", 0.3)")},className:"kanban-colum-header-btn",type:"button",children:[(0,U.jsx)("span",{style:{backgroundColor:"rgb(".concat(n,")")}}),(0,U.jsx)("span",{style:{backgroundColor:"rgb(".concat(n,")")}}),(0,U.jsx)("span",{style:{backgroundColor:"rgb(".concat(n,")")}})]})]})}),cn=function(e,n){var t={todo:1,"in-progress":2,done:3,delivered:4},i=e.label,o=n.label;return t[i]>t[o]?1:t[i]<t[o]?-1:0},vn=function(e){var n=e.kanban,t=e.onUpdateCell,i=e.selectedProjectId,o=e.nodeId,a=((0,Oe.$)().t,(0,d.useState)({columns:[]})),u=(0,r.Z)(a,2),s=u[0],c=u[1];(0,d.useEffect)((function(){c(function(e,n){var t,i,o,r={columns:[]};return(null===e||void 0===e||null===(t=e.columns)||void 0===t?void 0:t.length)>0&&(null===e||void 0===e||null===(o=e.columns)||void 0===o||o.forEach((function(t){var i,o,d,a=(0,M.lR)(t.label,{rgb:!0}).color,u=function(e){var n,i,o,l,r;return(null===e||void 0===e||null===(n=e.attributes)||void 0===n||null===(i=n.status)||void 0===i?void 0:i.toString())===(null===t||void 0===t?void 0:t.label)||(null===e||void 0===e||null===(o=e.tree)||void 0===o||null===(l=o.attributes)||void 0===l||null===(r=l.status)||void 0===r?void 0:r.toString())===(null===t||void 0===t?void 0:t.label)};"todo"==t.label&&(u=function(e){var n,i,o,l,r,d,a,u,s,c,v;return(null===e||void 0===e||null===(n=e.attributes)||void 0===n||null===(i=n.status)||void 0===i?void 0:i.toString())===(null===t||void 0===t?void 0:t.label)||(null===e||void 0===e||null===(o=e.tree)||void 0===o||null===(l=o.attributes)||void 0===l||null===(r=l.status)||void 0===r?void 0:r.toString())===(null===t||void 0===t?void 0:t.label)||(null!==e&&void 0!==e&&e.tree?!(null!==e&&void 0!==e&&null!==(d=e.tree)&&void 0!==d&&null!==(a=d.attributes)&&void 0!==a&&a.status)&&"empty"!==(null===e||void 0===e||null===(u=e.tree)||void 0===u||null===(s=u.attributes)||void 0===s?void 0:s.nodeType):!(null!==e&&void 0!==e&&null!==(c=e.attributes)&&void 0!==c&&c.status)&&"empty"!==(null===e||void 0===e||null===(v=e.attributes)||void 0===v?void 0:v.nodeType))});var s=null===e||void 0===e||null===(i=e.data)||void 0===i||null===(o=i.filter(u))||void 0===o?void 0:o.map((function(e){var t,i=null!==e&&void 0!==e&&e.attributes?null===e||void 0===e?void 0:e.attributes:null===e||void 0===e||null===(t=e.tree)||void 0===t?void 0:t.attributes;return i?(0,l.Z)((0,l.Z)({},i),{},{title:null===e||void 0===e?void 0:e.name,parentId:null!==e&&void 0!==e&&e.tree?null===e||void 0===e?void 0:e.id:n,color:a}):{}}));null===r||void 0===r||null===(d=r.columns)||void 0===d||d.push((0,l.Z)((0,l.Z)({},t),{},{id:t.label,color:a,title:t.label,cards:s}))}))),null===(i=r.columns)||void 0===i||i.sort(cn),r}(n,o))}),[n.data]);return s?(0,U.jsx)(un(),{renderColumnHeader:function(e){var n=e.title,t=e.color,i=e.iconName,o=e.id,l=e.label,r=e.cards;return(0,U.jsx)(sn,{title:n,color:t,id:o,iconName:i,label:l,cards:r})},onColumnDragEnd:function(){var e=arguments.length<=1?void 0:arguments[1],n=e.fromPosition,t=arguments.length<=2?void 0:arguments[2],i=t.toPosition,o=(0,l.Z)({},s);o.columns[n]=o.columns[i],o.columns[i]=arguments.length<=0?void 0:arguments[0],c(o)},onCardDragEnd:function(){var e,n,r,d,a=arguments.length<=1?void 0:arguments[1],u=a.fromPosition,v=a.fromColumnId,f=arguments.length<=2?void 0:arguments[2],p=f.toPosition,h=f.toColumnId,m=(0,l.Z)({},s),g=null===(e=m.columns)||void 0===e?void 0:e.find((function(e){return e.id==v}));null===g||void 0===g||null===(n=g.cards)||void 0===n||n.splice(u,1);var x,j,b,y,w=null===(r=m.columns)||void 0===r?void 0:r.find((function(e){return e.id==h}));v!==h&&(t&&t(o?{id:i,node:{parentNodeId:null===(x=arguments.length<=0?void 0:arguments[0])||void 0===x?void 0:x.parentId,id:null===(j=arguments.length<=0?void 0:arguments[0])||void 0===j?void 0:j.id,status:null===w||void 0===w?void 0:w.label}}:{id:null===(b=arguments.length<=0?void 0:arguments[0])||void 0===b?void 0:b.parentId,node:{id:null===(y=arguments.length<=0?void 0:arguments[0])||void 0===y?void 0:y.id,status:null===w||void 0===w?void 0:w.label}}));null===w||void 0===w||null===(d=w.cards)||void 0===d||d.splice(p,0,arguments.length<=0?void 0:arguments[0]),c(m)},children:s}):null},fn=["activeNode","projects","projectId"],pn={model_3d:dn,map:ie,kanban:function(e){var n,t=e.activeNode,i=e.projects,o=(e.projectId,(0,oe.Z)(e,fn)),r=(0,u.v)((function(e){return e})).projectNodeStatuses,d=null===r||void 0===r||null===(n=r.payload)||void 0===n?void 0:n.filter((function(e){return["todo","in-progress","done","delivered"].includes(e.label)}));return(0,U.jsx)(vn,(0,l.Z)((0,l.Z)({},o),{},{kanban:{columns:d,data:t?null===t||void 0===t?void 0:t.children:i}}))}},hn=function(e){var n=e.progress,t=e.color;return(0,U.jsx)("div",{className:"simple-progress-xx",style:{border:"1px solid ".concat(null!==t&&void 0!==t?t:"#295EA7")},children:(0,U.jsx)("span",{style:{width:"number"===typeof n?"".concat(n>100?n%100:n,"%"):n,backgroundColor:null!==t&&void 0!==t?t:"#295EA7"},children:(0,U.jsxs)("span",{style:{fontSize:10,width:"auto"},children:[n,"%"]})})})},mn=["onEnter","style","className","onBlur","defaultValue","readonly"],gn=function(e){var n=e.onEnter,t=e.style,i=e.className,o=e.onBlur,r=e.defaultValue,d=e.readonly,a=(0,oe.Z)(e,mn);return(0,U.jsx)("input",(0,l.Z)((0,l.Z)({style:(0,l.Z)((0,l.Z)({},{width:"100%",background:"transparent",border:"none",borderBottom:"1px solid transparent",outline:"none",margin:0,lineHeight:"inherit",fontFamily:"inherit",fontSize:"inherit"}),null!==t&&void 0!==t?t:{}),onKeyDown:function(e){var t,i,o,l=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value;if(n)if(null!==e&&void 0!==e&&e.key&&"enter"===(null===e||void 0===e||null===(i=e.key)||void 0===i?void 0:i.toLowerCase()))(null===l||void 0===l?void 0:l.toString())!==(null===r||void 0===r?void 0:r.toString())&&n(l);else if(null!==e&&void 0!==e&&e.key&&"tab"===(null===e||void 0===e||null===(o=e.key)||void 0===o?void 0:o.toLowerCase())){var d;null!==l&&void 0!==l&&null!==(d=l.toString())&&void 0!==d&&d.trim()&&n(l)}},onBlur:function(e){var n,t,i=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value;o&&(null===i||void 0===i?void 0:i.toString())!==(null===r||void 0===r?void 0:r.toString())&&o(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)},defaultValue:r,readOnly:d},a),{},{className:"editable-cell-sb ".concat(null!==i&&void 0!==i?i:"")}))},xn=["children"],jn=function(e){var n=e.children,t=(0,oe.Z)(e,xn);return(0,U.jsx)("tr",(0,l.Z)((0,l.Z)({},t),{},{children:n}))},bn=t(1260),yn=["onChange","onEnter","style","className","options","selected","color","editable"],wn=function(e){var n,t=e.onChange,i=(e.onEnter,e.style),o=e.className,a=e.options,u=e.selected,s=e.color,c=e.editable,v=(0,oe.Z)(e,yn),f=(0,Oe.$)().t,p=null===a||void 0===a?void 0:a.find((function(e){return(null===e||void 0===e?void 0:e.label)===u})),h=(0,d.useState)(!1),m=(0,r.Z)(h,2),g=m[0],x=m[1],j=(0,d.useState)(""),b=(0,r.Z)(j,2),y=b[0],w=b[1];return(0,U.jsxs)("div",(0,l.Z)((0,l.Z)({style:(0,l.Z)((0,l.Z)({},{width:"100%",background:null!==s&&void 0!==s?s:"transparent",border:"none",outline:"none",margin:0,lineHeight:"inherit",fontFamily:"inherit",fontSize:"inherit",position:"relative"}),null!==i&&void 0!==i?i:{})},v),{},{className:"dropdown-select-cell-sb ".concat(null!==o&&void 0!==o?o:""),children:[(0,U.jsx)("input",{style:{width:"100%",background:"transparent",border:"none",outline:"none",margin:0,lineHeight:"inherit",fontFamily:"inherit",fontSize:"inherit",position:"relative",cursor:"pointer"},className:"dropdown-select-cell-input",value:y||f(null!==(n=null===p||void 0===p?void 0:p.label)&&void 0!==n?n:""),onChange:function(e){var n;return w(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)},onFocus:function(){return x(!0)},readOnly:!c,onBlur:function(){setTimeout((function(){return x(!1)}),300)}}),(0,U.jsx)(bn.Z.Menu,{style:{maxHeight:100,overflow:"auto",backgroundColor:"#dfdfdf"},show:g,children:(null===a||void 0===a?void 0:a.length)>0&&(0,U.jsx)(U.Fragment,{children:null===a||void 0===a?void 0:a.map((function(e){var n,i,o=(0,M.lR)(null===e||void 0===e?void 0:e.label,{rgb:!0}).color;return(0,U.jsx)(bn.Z.Item,{value:null!==(n=null===e||void 0===e?void 0:e.id)&&void 0!==n?n:null===e||void 0===e?void 0:e.label,style:{padding:"1px 0",borderLeft:(null===p||void 0===p?void 0:p.label)===(null===e||void 0===e?void 0:e.label)||(null===p||void 0===p?void 0:p.id)===(null===e||void 0===e?void 0:e.id)?"3px solid rgb(".concat(o,")"):""},children:(0,U.jsx)("button",{className:"dropdown-select-button",style:{color:"rgb(".concat(o,")"),backgroundColor:"rgba(".concat(o,", 0.4)"),padding:5},onClick:function(){var n;return function(e){t(e)}(null!==(n=null===e||void 0===e?void 0:e.label)&&void 0!==n?n:null===e||void 0===e?void 0:e.id)},children:f(null!==(i=null===e||void 0===e?void 0:e.label)&&void 0!==i?i:"")})},(null===e||void 0===e?void 0:e.label)+(null===e||void 0===e?void 0:e.id))}))})})]}))},Zn=["data","meta","treeMeta","newColumn","newRow","appendColums"],Nn=function(e){var n,t=e.data,o=e.meta,d=e.treeMeta,a=e.newColumn,u=e.newRow,s=e.appendColums,c=(0,oe.Z)(e,Zn);console.count("rendering datatable");var v=function(e){return"string"===typeof e?e:null},f={};(null===t||void 0===t?void 0:t.length)>0&&t.forEach((function(e){var n,t,i,o,l,r;null!==(n=e.tree)&&void 0!==n&&null!==(t=n.children)&&void 0!==t&&t.length&&(null===e||void 0===e||null===(o=e.tree)||void 0===o||null===(l=o.children)||void 0===l||l.forEach((function(e){e.name&&(f[e.name]=e)})));null!==e&&void 0!==e&&null!==(i=e.children)&&void 0!==i&&i.length&&(null===e||void 0===e||null===(r=e.children)||void 0===r||r.forEach((function(e){e.name&&(f[e.name]=e)})))}));var p=[].concat((0,i.Z)(Object.keys((0,l.Z)((0,l.Z)({},null!==o&&void 0!==o?o:{}),null!==f&&void 0!==f?f:{}))),(0,i.Z)(s),["empty"]);return(null===t||void 0===t?void 0:t.length)>0?(0,U.jsx)("div",(0,l.Z)((0,l.Z)({},c),{},{style:{maxWidth:"100vw",overflow:"auto",maxHeight:"20vh",overflowY:"auto"},children:(0,U.jsxs)("table",{className:"data-table-xx",style:{borderCollapse:"collapse",borderRadius:5},children:[(0,U.jsx)("thead",{children:(0,U.jsx)(jn,{children:(0,U.jsxs)(U.Fragment,{children:[Object.entries(o).map((function(e){var n,t=(0,r.Z)(e,2),i=t[0],o=t[1];return(0,U.jsx)("th",{children:null!==(n=o.displayName)&&void 0!==n?n:i},i)})),Object.keys(f).map((function(e){return(0,U.jsx)("th",{style:{textTransform:"capitalize"},children:e},e)})),s.map((function(e){return(0,U.jsx)("th",{style:{textTransform:"capitalize"},children:e},e)})),(0,U.jsx)("th",{style:{textAlign:"center"},children:a.renderHeader()})]})})}),(0,U.jsxs)("tbody",{children:[null===t||void 0===t||null===(n=t.filter((function(e){var n;return"empty"!==(null===e||void 0===e||null===(n=e.attributes)||void 0===n?void 0:n.nodeType)})))||void 0===n?void 0:n.map((function(e,n){var t,i,l,u,c,p,h;return(0,U.jsxs)("tr",{id:null!==(l=null===e||void 0===e||null===(u=e.id)||void 0===u?void 0:u.toString())&&void 0!==l?l:null===e||void 0===e||null===(c=e.attributes)||void 0===c?void 0:c.id,onKeyDown:function(n){var t,i,o;return function(e,n){var t,i,o,l=document.getElementById(e);null!==n&&void 0!==n&&n.key&&"enter"===(null===n||void 0===n||null===(t=n.key)||void 0===t?void 0:t.toLowerCase())&&l&&(null===l||void 0===l||null===(i=l.nextElementSibling)||void 0===i||null===(o=i.querySelector("input:not(:read-only)"))||void 0===o||o.focus())}(null!==(t=null===e||void 0===e||null===(i=e.id)||void 0===i?void 0:i.toString())&&void 0!==t?t:null===e||void 0===e||null===(o=e.attributes)||void 0===o?void 0:o.id,n)},children:[Object.entries(o).map((function(t){var i=(0,r.Z)(t,2),o=i[0],l=i[1];return(0,U.jsx)("td",{"data-key":o,children:l.render?l.render(e,n,f):v(e[o])},o)})),Object.values(f).map((function(t){var i,o,l,r,a,u;if(null!==e&&void 0!==e&&null!==(i=e.tree)&&void 0!==i&&i.children&&(null===e||void 0===e||null===(o=e.tree)||void 0===o?void 0:o.children.length)>1||(null===e||void 0===e||null===(l=e.children)||void 0===l?void 0:l.length)>0){var s,c,v,f,p,h,m,g,x,j,b,y,w,Z,N=null!==e&&void 0!==e&&e.tree?null===e||void 0===e||null===(s=e.tree)||void 0===s||null===(c=s.children)||void 0===c?void 0:c.find((function(e){return e.name===(null===t||void 0===t?void 0:t.name)})):null===e||void 0===e||null===(v=e.children)||void 0===v?void 0:v.find((function(e){return e.name===(null===t||void 0===t?void 0:t.name)}));return N?(0,U.jsx)("td",{"data-key":N.name+(null!==(f=null===e||void 0===e?void 0:e.id)&&void 0!==f?f:null===e||void 0===e||null===(p=e.attributes)||void 0===p?void 0:p.id),children:d.status?null===(g=d.status)||void 0===g?void 0:g.render(e,N,n):null===(x=d.data)||void 0===x?void 0:x.render(e,N,n)},N.name+(null!==(h=null===e||void 0===e?void 0:e.id)&&void 0!==h?h:null===e||void 0===e||null===(m=e.attributes)||void 0===m?void 0:m.id)):(0,U.jsx)("td",{"data-key":(null!==(j=null===e||void 0===e?void 0:e.id)&&void 0!==j?j:null===e||void 0===e||null===(b=e.attributes)||void 0===b?void 0:b.id)+(null===t||void 0===t?void 0:t.name),children:null===(Z=d.none)||void 0===Z?void 0:Z.render(e,t,n)},(null!==(y=null===e||void 0===e?void 0:e.id)&&void 0!==y?y:null===e||void 0===e||null===(w=e.attributes)||void 0===w?void 0:w.id)+(null===t||void 0===t?void 0:t.name))}return(0,U.jsx)("td",{children:null===(u=d.none)||void 0===u?void 0:u.render(e,t,n)},(null!==(r=null===e||void 0===e?void 0:e.id)&&void 0!==r?r:null===e||void 0===e||null===(a=e.attributes)||void 0===a?void 0:a.id)+(null===t||void 0===t?void 0:t.name))})),s.map((function(t){var i,o,l;return(0,U.jsx)("td",{children:null===(l=d.none)||void 0===l?void 0:l.render(e,{name:t},n)},(null!==(i=null===e||void 0===e?void 0:e.id)&&void 0!==i?i:null===e||void 0===e||null===(o=e.attributes)||void 0===o?void 0:o.id)+t)})),(0,U.jsx)("td",{children:a.renderData(n)},(null!==(p=null===e||void 0===e?void 0:e.id)&&void 0!==p?p:null===e||void 0===e||null===(h=e.attributes)||void 0===h?void 0:h.id)+"new")]},null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null===e||void 0===e||null===(i=e.attributes)||void 0===i?void 0:i.id)})),u&&(0,U.jsx)("tr",{children:p.map((function(e,n){return(0,U.jsx)("td",{children:u.render(e,n,p.length)},e)}))})]}),(0,U.jsx)("tfoot",{children:(0,U.jsx)("tr",{children:p.map((function(e,n){return(0,U.jsx)("td",{children:(0,U.jsx)("span",{style:{visibility:"hidden",display:"flex"},children:"h"})},e)}))})})]})})):null},kn=(0,d.memo)(Nn),Cn=t(5530),Sn=["data","onUpdateNode","onUpdateCell","onAddNewNode","statusOptions","newColumns","onNewColumnBlur","onAddNewColumn","newColumnName","onNewRowClick"],En=function(e){var n=e.data,t=e.onUpdateNode,o=e.onUpdateCell,a=e.onAddNewNode,u=e.statusOptions,s=e.newColumns,c=e.onNewColumnBlur,v=e.onAddNewColumn,f=e.newColumnName,p=e.onNewRowClick,h=(0,oe.Z)(e,Sn),m=(0,Oe.$)().t,g=(0,d.useState)(!1),x=(0,r.Z)(g,2),j=x[0],b=x[1],y=function(e){c&&c(e),b(!1)},w=function(e){v&&null!==e&&void 0!==e&&e.trim()&&v(e),b(!1)},Z=function(e){p&&p(e)};return(0,U.jsx)(kn,(0,l.Z)((0,l.Z)({},h),{},{data:(0,i.Z)(n).sort(M.R1),meta:{name:{displayName:m("project-name"),render:function(e,n){return(0,U.jsx)("div",{style:{padding:0,background:"#fff",borderTopLeftRadius:0===n?5:0,borderTopRightRadius:0===n?5:0},children:(0,U.jsx)(gn,{style:{textAlign:"right"},onEnter:function(n){return t({id:e.id,node:{name:n}})},defaultValue:e.name})})}},creator:{displayName:m("project-manager"),render:function(e,n){var t,i,o,l,r,d,a,u;return(0,U.jsx)("div",{style:{padding:"0 5px",background:"#fff",borderTopLeftRadius:0===n?5:0,borderTopRightRadius:0===n?5:0},title:"".concat(null!==(t=null===(i=e.creator)||void 0===i?void 0:i.firstName)&&void 0!==t?t:""," ").concat(null!==(o=null===(l=e.creator)||void 0===l?void 0:l.lastName)&&void 0!==o?o:""),children:(0,U.jsx)(gn,{readonly:!0,style:{textAlign:"right"},onEnter:function(e){return console.log(e)},defaultValue:"".concat(null!==(r=null===(d=e.creator)||void 0===d?void 0:d.firstName)&&void 0!==r?r:""," ").concat(null!==(a=null===(u=e.creator)||void 0===u?void 0:u.lastName)&&void 0!==a?a:"")})})}},progression:{displayName:m("progression"),render:function(e,n,t){var i=(0,M.dh)(null===e||void 0===e?void 0:e.tree);return(0,U.jsx)("div",{style:{display:"flex",background:"#fff",borderBottom:"2px solid #fff",borderTopLeftRadius:0===n?5:0,borderTopRightRadius:0===n?5:0},children:(0,U.jsx)(hn,{color:"#ED6E40",progress:Math.round(100*i)})})}},status:{displayName:m("status"),render:function(e){var n,t,i,l=(0,M.lR)(null!==e&&void 0!==e&&e.tree?null===e||void 0===e||null===(n=e.tree)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.status:null===e||void 0===e||null===(i=e.attributes)||void 0===i?void 0:i.status);return(0,U.jsx)(wn,{options:u,selected:l.status,onChange:function(n){var t,i;return o({id:e.id,node:{id:null===e||void 0===e||null===(t=e.tree)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.id,status:n}})},color:l.color})}}},treeMeta:{status:{render:function(e,n){var t,i,l,r=(0,M.lR)(null!==n&&void 0!==n&&n.tree?null===n||void 0===n||null===(t=n.tree)||void 0===t||null===(i=t.attributes)||void 0===i?void 0:i.status:null===n||void 0===n||null===(l=n.attributes)||void 0===l?void 0:l.status);return(0,U.jsx)(wn,{options:u,selected:r.status,onChange:function(t){var i;return o({id:e.id,node:{id:null===n||void 0===n||null===(i=n.attributes)||void 0===i?void 0:i.id,status:t}})},color:r.color})}},none:{render:function(e,n){return(0,U.jsx)(Cn.Z,{style:{height:20,width:20},onClick:function(){return function(e){var n=e.id,t=e.node;a&&a({id:n,node:t})}({id:e.id,node:n})}})}}},newColumn:{renderData:function(e){return(0,U.jsx)("div",{style:{display:"flex",background:"#fff",borderTopLeftRadius:0===e?5:0,borderTopRightRadius:0===e?5:0},children:(0,U.jsx)(gn,{readonly:!0})})},renderHeader:function(){return j?(0,U.jsx)(gn,{autoFocus:!0,style:{textAlign:"right"},onBlur:y,onEnter:w,defaultValue:f}):(0,U.jsx)(Cn.Z,{style:{height:20,width:20},onClick:function(){return b(!0)}})}},newRow:{render:function(e,n,t){return(0,U.jsx)("div",{style:{display:"flex",background:"#fff",borderBottomLeftRadius:0===n?5:0,borderBottomRightRadius:n===t-1?5:0},children:0===n?(0,U.jsx)("span",{style:{padding:"0 10px"},title:m("use-map-to-select-location"),children:(0,U.jsx)(Cn.Z,{style:{height:20,width:20,marginTop:-5},onClick:Z})}):(0,U.jsx)("span",{style:{visibility:"hidden"},children:"h"})})}},appendColums:s}))},An=["data","meta","treeMeta","newColumn","newRow","appendColums"],Rn=function(e){var n,t=e.data,o=e.meta,a=e.treeMeta,u=e.newColumn,s=e.newRow,c=e.appendColums,v=(0,oe.Z)(e,An),f=(0,d.useState)({}),p=(0,r.Z)(f,2),h=p[0],m=p[1],g=function(e){return"string"===typeof e?e:null};(0,d.useEffect)((function(){if((null===t||void 0===t?void 0:t.length)>0){var e={};t.forEach((function(n){var t,i;null!==n&&void 0!==n&&null!==(t=n.children)&&void 0!==t&&t.length&&(null===n||void 0===n||null===(i=n.children)||void 0===i||i.forEach((function(n){n.name&&(e[n.name]=n)})))})),m(e)}}),[t]);var x=[].concat((0,i.Z)(Object.keys((0,l.Z)((0,l.Z)({},null!==o&&void 0!==o?o:{}),null!==h&&void 0!==h?h:{}))),(0,i.Z)(c),["empty"]);return(null===t||void 0===t?void 0:t.length)>0?(0,U.jsx)("div",(0,l.Z)((0,l.Z)({},v),{},{style:{maxWidth:"100vw",overflow:"auto",maxHeight:"20vh",overflowY:"auto"},children:(0,U.jsxs)("table",{className:"data-table-xx",style:{borderCollapse:"collapse",borderRadius:5},children:[(0,U.jsx)("thead",{children:(0,U.jsx)(jn,{children:(0,U.jsxs)(U.Fragment,{children:[Object.entries(o).map((function(e){var n,t=(0,r.Z)(e,2),i=t[0],o=t[1];return(0,U.jsx)("th",{children:null!==(n=o.displayName)&&void 0!==n?n:i},i)})),Object.keys(h).map((function(e){return(0,U.jsx)("th",{style:{textTransform:"capitalize"},children:e},e)})),c.map((function(e){return(0,U.jsx)("th",{style:{textTransform:"capitalize"},children:e},e)})),(0,U.jsx)("th",{style:{textAlign:"center"},children:u.renderHeader()})]})})}),(0,U.jsxs)("tbody",{children:[null===t||void 0===t||null===(n=t.filter((function(e){var n;return"empty"!==(null===e||void 0===e||null===(n=e.attributes)||void 0===n?void 0:n.nodeType)})))||void 0===n?void 0:n.map((function(e,n){var t,i,l,d,s,v,f;return(0,U.jsxs)("tr",{id:null!==(d=null===e||void 0===e||null===(s=e.attributes)||void 0===s||null===(v=s.id)||void 0===v?void 0:v.toString())&&void 0!==d?d:null===e||void 0===e?void 0:e.name,onKeyDown:function(n){var t,i,o;return function(e,n){var t,i,o,l=document.getElementById(e);null!==n&&void 0!==n&&n.key&&"enter"===(null===n||void 0===n||null===(t=n.key)||void 0===t?void 0:t.toLowerCase())&&l&&(null===l||void 0===l||null===(i=l.nextElementSibling)||void 0===i||null===(o=i.querySelector("input:not(:read-only)"))||void 0===o||o.focus())}(null!==(t=null===e||void 0===e||null===(i=e.attributes)||void 0===i||null===(o=i.id)||void 0===o?void 0:o.toString())&&void 0!==t?t:null===e||void 0===e?void 0:e.name,n)},children:[Object.entries(o).map((function(t){var i=(0,r.Z)(t,2),o=i[0],l=i[1];return(0,U.jsx)("td",{"data-key":o,children:l.render?l.render(e,n):g(e[o])},o)})),Object.values(h).map((function(t){var i,o,l;if((null===e||void 0===e||null===(i=e.children)||void 0===i?void 0:i.length)>0){var r,d,u,s,c,v,f,p,h=null===e||void 0===e||null===(r=e.children)||void 0===r?void 0:r.find((function(e){return e.name===(null===t||void 0===t?void 0:t.name)}));return h?(0,U.jsx)("td",{"data-key":h.name+(null===e||void 0===e||null===(d=e.attributes)||void 0===d?void 0:d.id),children:a.status?null===(s=a.status)||void 0===s?void 0:s.render(e,h,n):null===(c=a.data)||void 0===c?void 0:c.render(e,h,n)},h.name+(null===e||void 0===e||null===(u=e.attributes)||void 0===u?void 0:u.id)):(0,U.jsx)("td",{"data-key":(null===e||void 0===e||null===(v=e.attributes)||void 0===v?void 0:v.id)+(null===t||void 0===t?void 0:t.name),children:null===(p=a.none)||void 0===p?void 0:p.render(e,t,n)},(null===e||void 0===e||null===(f=e.attributes)||void 0===f?void 0:f.id)+(null===t||void 0===t?void 0:t.name))}return(0,U.jsx)("td",{children:null===(l=a.none)||void 0===l?void 0:l.render(e,t,n)},(null===e||void 0===e||null===(o=e.attributes)||void 0===o?void 0:o.id)+(null===t||void 0===t?void 0:t.name))})),c.map((function(t){var i,o;return(0,U.jsx)("td",{children:null===(o=a.none)||void 0===o?void 0:o.render(e,{name:t},n)},(null===e||void 0===e||null===(i=e.attributes)||void 0===i?void 0:i.id)+t)})),(0,U.jsx)("td",{children:u.renderData(n)},(null===e||void 0===e||null===(f=e.attributes)||void 0===f?void 0:f.id)+"new")]},null!==(t=null===e||void 0===e||null===(i=e.attributes)||void 0===i||null===(l=i.id)||void 0===l?void 0:l.toString())&&void 0!==t?t:null===e||void 0===e?void 0:e.name)})),s&&(0,U.jsx)("tr",{children:x.map((function(e,n){return(0,U.jsx)("td",{children:s.render(e,n,x.length)},e)}))})]}),(0,U.jsx)("tfoot",{children:(0,U.jsx)("tr",{children:x.map((function(e,n){return(0,U.jsx)("td",{children:(0,U.jsx)("span",{style:{visibility:"hidden",display:"flex"},children:"h"})},e)}))})})]})})):null},In=["data","node","onUpdateNode","onUpdateCell","onAddNewNode","statusOptions","newColumns","onNewColumnBlur","onAddNewColumn","newColumnName","onNewRowClick","selectedProjectId"],Dn=function(e){e.data;var n=e.node,t=(e.onUpdateNode,e.onUpdateCell),a=e.onAddNewNode,u=(e.statusOptions,e.newColumns),s=e.onNewColumnBlur,c=e.onAddNewColumn,v=e.newColumnName,f=(e.onNewRowClick,e.selectedProjectId),p=(0,oe.Z)(e,In),h=(0,Oe.$)().t,m=(0,d.useState)(!1),g=(0,r.Z)(m,2),x=g[0],j=g[1],b=(0,d.useState)({}),y=(0,r.Z)(b,2),w=y[0],Z=y[1],N=(0,d.useState)({}),k=(0,r.Z)(N,2),C=k[0],S=k[1],E=(0,d.useState)([]),A=(0,r.Z)(E,2),R=A[0],I=A[1],D=function(e){var n=e.id,t=e.node;a&&a({id:n,node:t})},L=function(e){s&&s(e),j(!1)},_=function(e){c&&null!==e&&void 0!==e&&e.trim()&&c(e),j(!1)},T=function(e){I((function(e){return[].concat((0,i.Z)(e),[(0,l.Z)((0,l.Z)({},M.Z),{},{attributes:(0,l.Z)((0,l.Z)({},M.Z.attributes),{},{id:(new Date).getTime()*Math.random(),nodeType:"libre"})})])}))};return(0,d.useEffect)((function(){var e;I((0,i.Z)(null!==(e=null===n||void 0===n?void 0:n.children)&&void 0!==e?e:[]).sort(M.R1))}),[n]),(0,U.jsx)(Rn,(0,l.Z)((0,l.Z)({},p),{},{data:R,meta:{elements:{displayName:h("elements"),render:function(e,n){var i,r,d;return(0,U.jsx)("div",{style:{display:"flex",background:"#fff",borderTopLeftRadius:0===n?5:0,borderTopRightRadius:0===n?5:0},children:(0,U.jsx)(gn,{style:{textAlign:"right"},onEnter:function(n){var i;return t({id:f,node:{id:null===e||void 0===e||null===(i=e.attributes)||void 0===i?void 0:i.id,name:n}})},onChange:function(n){return Z((function(t){var i,r;return(0,l.Z)((0,l.Z)({},t),{},(0,o.Z)({},null===e||void 0===e||null===(i=e.attributes)||void 0===i?void 0:i.id,null===n||void 0===n||null===(r=n.target)||void 0===r?void 0:r.value))}))},value:null!==(i=w[null===e||void 0===e||null===(r=e.attributes)||void 0===r?void 0:r.id])&&void 0!==i?i:e.name,title:null===e||void 0===e||null===(d=e.attributes)||void 0===d?void 0:d.data})})}}},treeMeta:{data:{render:function(e,n,i){var r,d,a;return(0,U.jsx)("div",{style:{display:"flex",background:"#fff",borderTopLeftRadius:0===i?5:0,borderTopRightRadius:0===i?5:0},children:(0,U.jsx)(gn,{autoFocus:!0,style:{textAlign:"right"},onEnter:function(e){var i;return t({id:f,node:{id:null===n||void 0===n||null===(i=n.attributes)||void 0===i?void 0:i.id,data:e}})},onChange:function(e){return S((function(t){var i,r;return(0,l.Z)((0,l.Z)({},t),{},(0,o.Z)({},null===n||void 0===n||null===(i=n.attributes)||void 0===i?void 0:i.id,null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value))}))},value:null!==(r=C[null===n||void 0===n||null===(d=n.attributes)||void 0===d?void 0:d.id])&&void 0!==r?r:(null===n||void 0===n||null===(a=n.attributes)||void 0===a?void 0:a.data)||""})})}},empty:{render:function(e,n){return(0,U.jsx)(Cn.Z,{style:{height:20,width:20},onClick:function(){var t;return D({id:f,node:(0,l.Z)((0,l.Z)({},n),{},{parentNodeId:null===e||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.id})})}})}},none:{render:function(e,n,t){return(0,U.jsx)("div",{style:{display:"flex",background:"#eee",borderTopLeftRadius:0===t?5:0,borderTopRightRadius:0===t?5:0},children:(0,U.jsx)(gn,{onEnter:function(t){var i;return D({id:f,node:(0,l.Z)((0,l.Z)({},n),{},{data:t,parentNodeId:null===e||void 0===e||null===(i=e.attributes)||void 0===i?void 0:i.id})})}})})}}},newColumn:{renderData:function(e){return(0,U.jsx)("div",{style:{display:"flex",background:"#fff",borderTopLeftRadius:0===e?5:0,borderTopRightRadius:0===e?5:0},children:(0,U.jsx)(gn,{readonly:!0})})},renderHeader:function(){return x?(0,U.jsx)(gn,{autoFocus:!0,style:{textAlign:"right"},onBlur:L,onEnter:_,defaultValue:v}):(0,U.jsx)(Cn.Z,{style:{height:20,width:20},onClick:function(){return j(!0)}})}},newRow:{render:function(e,n,t){return(0,U.jsx)("div",{style:{display:"flex",background:"#fff",borderBottomLeftRadius:0===n?5:0,borderBottomRightRadius:n===t-1?5:0},children:0===n?(0,U.jsx)("span",{style:{padding:"0 10px"},title:h("use-map-to-select-location"),children:(0,U.jsx)(Cn.Z,{style:{height:20,width:20,marginTop:-5},onClick:T})}):(0,U.jsx)("span",{style:{visibility:"hidden"},children:"h"})})}},appendColums:u}))},Ln=function(){var e,n,t,s=(0,u.I)(),c=(0,u.v)((function(e){return e.projects})),v=(0,u.v)((function(e){return e.knowledgeTree})),f=(0,u.v)((function(e){return e.projectNodeTypes})),p=(0,u.v)((function(e){return e.projectNodeStatuses})),h=(0,u.v)((function(e){return e.mapMeta})),m=(0,u.v)((function(e){return e.representation})),g=(0,u.v)((function(e){return e.nodeData})),x=(0,u.v)((function(e){return e.pages.selected_tab})),j=(0,u.v)((function(e){return e.pages.map_view})),b=(0,d.useState)({}),y=(0,r.Z)(b,2),w=y[0],Z=y[1],N=(0,d.useState)(""),k=(0,r.Z)(N,2),C=k[0],S=k[1],E=(0,d.useState)(!1),A=(0,r.Z)(E,2),R=A[0],D=A[1],L=(0,d.useState)(),_=(0,r.Z)(L,2),T=_[0],V=_[1],F=(0,d.useState)(M.Z),B=(0,r.Z)(F,2),P=B[0],O=B[1],H=(0,d.useState)(),q=(0,r.Z)(H,2),W=q[0],G=q[1],$=(0,d.useState)(),K=(0,r.Z)($,2),Y=K[0],Q=K[1],J=(0,d.useState)(),ee=(0,r.Z)(J,2),oe=ee[0],le=ee[1],re=(0,d.useState)(""),de=(0,r.Z)(re,2),ae=de[0],ue=de[1],se=(0,d.useState)(!1),ce=(0,r.Z)(se,2),ve=ce[0],fe=ce[1],pe=(0,d.useState)([]),he=(0,r.Z)(pe,2),me=he[0],ge=he[1],xe=(0,Oe.$)().t,je=function(e){v.payload&&s((0,ne.fR)({is_active:e,name:v.payload.name}))};(0,d.useEffect)((function(){s((0,a.w)()),s((0,I.mW)()),s((0,Te.y)(Y)),s((0,Ue.N)(Y))}),[]),(0,d.useEffect)((function(){var e;!c.isLoading&&c.payload&&(G(c.payload),(null===c||void 0===c||null===(e=c.payload)||void 0===e?void 0:e.length)>0&&Q((function(e){var n;return e||(null===c||void 0===c||null===(n=c.payload[0])||void 0===n?void 0:n.id)})))}),[c]),(0,d.useEffect)((function(){Y&&("new-project"!==Y?s((0,te.AV)(Y)):O(M.Z))}),[Y]);var be=(0,d.useMemo)((function(){var e;return null===c||void 0===c||null===(e=c.payload)||void 0===e?void 0:e.find((function(e){return e.id===Y}))}),[Y]);(0,d.useEffect)((function(){!v.isLoading&&v.payload&&(O(v.payload),G(c.payload))}),[v]),(0,d.useEffect)((function(){if("undefined"!==typeof T&&null!==T){s((0,ne.aH)(!0));for(var e=(0,l.Z)({},T),n={};null!==e&&void 0!==e;){var t,i,r,d,a,u,c,v,f,p,h,m,g,x,j,b;if(null!==(t=e)&&void 0!==t&&null!==(i=t.data)&&void 0!==i&&null!==(r=i.attributes)&&void 0!==r&&r.id&&null!==(d=e)&&void 0!==d&&null!==(a=d.parent)&&void 0!==a&&null!==(u=a.data)&&void 0!==u&&null!==(c=u.attributes)&&void 0!==c&&c.id)n=(0,l.Z)((0,l.Z)({},n),{},(b={},(0,o.Z)(b,null===(f=e)||void 0===f||null===(p=f.parent)||void 0===p||null===(h=p.data)||void 0===h||null===(m=h.attributes)||void 0===m?void 0:m.id,e.parent),(0,o.Z)(b,null===(g=e)||void 0===g||null===(x=g.data)||void 0===x||null===(j=x.attributes)||void 0===j?void 0:j.id,e),b));e=null===(v=e)||void 0===v?void 0:v.parent}Z(n),je(!0)}else je(!1),S("")}),[T]);var ye=function(e){var n,t;switch(V(e),function(e){S(e.data.attributes.id.toString()),"ifc"===e.data.attributes.nodeType?(s((0,He.v7)(e.data.attributes.id.toString())),s((0,ne.aH)(!1))):"ifc"!==e.data.attributes.nodeType&&s((0,ne.aH)(!0))}(e),null===e||void 0===e||null===(n=e.data)||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t.nodeType){case"ifc":case"model_3d":s((0,Ce.BR)("model_3d"));break;default:s((0,Ce.BR)("kanban"))}};(0,d.useEffect)((function(){console.log(j)}),[j]),(0,d.useEffect)((function(){g.response.errors.length>0?D(!1):null!=g.response.content&&D(!0)}),[g]);var we=function(e){var n,t,o,l=e.id,r=e.node;s((0,te.VR)({id:l,node:{description:null===r||void 0===r||null===(n=r.attributes)||void 0===n?void 0:n.description,name:null===r||void 0===r?void 0:r.name,nodeType:null!==(t=null===r||void 0===r||null===(o=r.attributes)||void 0===o?void 0:o.nodeType)&&void 0!==t?t:"libre",parentNodeId:null===r||void 0===r?void 0:r.parentNodeId,data:null===r||void 0===r?void 0:r.data}})).unwrap().then((function(){var e=null===me||void 0===me?void 0:me.findIndex((function(e){return e===r.name}));if(e>-1){var n=(0,i.Z)(me);n.splice(e,1),ge(n)}}))},Ze=function(e){null!==e&&void 0!==e&&e.trim()&&(ge([].concat((0,i.Z)(me),[e])),ue(""))},Ne=function(e){var n=e.id,t=e.node;s((0,te.sU)({id:n,node:t}))},ke=function(e){ue(e)},Se=function(){fe(!0),s((0,X.eW)("create_project"))},Ee=function(e){var n=e.id,t=e.node;s((0,I.ty)({id:n,node:t}))},Re=(0,d.useMemo)((function(){var e;return null!==(e=pn[m])&&void 0!==e?e:ie}),[m]);return console.count("dashboard"),(0,U.jsxs)(U.Fragment,{children:["Invitation"===x&&(0,U.jsx)(ze,{project:Y}),(0,U.jsxs)("div",{className:"dashboard-layout",children:[(0,U.jsxs)("div",{className:"explorer",children:[(0,U.jsx)(Le,{title:"Explorer",search:(0,U.jsx)(_e,{active:T,activeNodes:w,setActive:ye,setActiveNodes:Z,projects:W,selectedProjectId:Y,setSelectedProjectId:Q})}),(0,U.jsx)(Fe,{favs:null!==(e=f.payload)&&void 0!==e?e:[]}),(0,U.jsx)("div",{className:"canvas-explorer",children:(0,U.jsx)(Ae,{active:T,treeData:P,activeNodes:w,setActive:ye,setActiveNodes:Z,selectedProjectId:Y,mapCoords:oe})})]}),(0,U.jsxs)("div",{className:"project",children:[(0,U.jsx)(Le,{title:"Contextualiser (".concat(null!==T&&void 0!==T&&null!==(n=T.data)&&void 0!==n&&n.name?null===T||void 0===T||null===(t=T.data)||void 0===t?void 0:t.name:"Mes projets",")"),search:(0,U.jsx)(Ye,{options:Object.entries(Ce.cy).filter((function(e){var n=(0,r.Z)(e,2);n[0];return n[1]})).map((function(e){var n=(0,r.Z)(e,1)[0];return{id:n,label:n}})),onChange:function(e){return n=e,void s((0,Ce.BR)(n));var n},selected:m,activeNode:null===T||void 0===T?void 0:T.data})}),(0,U.jsx)("div",{className:"presentation-container",children:(0,U.jsx)(Ke,{children:(0,U.jsx)(Re,{activeNode:null===T||void 0===T?void 0:T.data,projectId:null===be||void 0===be?void 0:be.id,nodeName:null===be||void 0===be?void 0:be.name,has_urn:R,nodeId:C,onPin:le,pins:W,projects:W,onUpdateNode:Ee,onUpdateCell:Ne,onAddNewNode:we,onAddNewColumn:Ze,selectedProjectId:Y})})}),null!==T&&void 0!==T&&T.data?(0,U.jsx)(Dn,{selectedProjectId:Y,id:"node-data-table-10x",node:null===T||void 0===T?void 0:T.data,onUpdateNode:Ee,onUpdateCell:Ne,onAddNewNode:we,onNewColumnBlur:ke,onAddNewColumn:Ze,newColumnName:ae,newColumns:me,onNewRowClick:Se,statusOptions:p.payload}):(0,U.jsxs)(U.Fragment,{children:[(null===W||void 0===W?void 0:W.length)>0?(0,U.jsx)(En,{id:"project-data-table-10x",data:W,onUpdateNode:Ee,onUpdateCell:Ne,onAddNewNode:we,onNewColumnBlur:ke,onAddNewColumn:Ze,newColumnName:ae,newColumns:me,onNewRowClick:Se,statusOptions:p.payload}):null,ve?(0,U.jsxs)(z.Z,{show:ve,el:"#project-data-table-10x",container:"#project-data-table-10x",onDismiss:function(){s((0,X.xZ)("create_project")),fe(!1)},children:[(0,U.jsx)("code",{children:h.selection.description}),(0,U.jsx)("blockquote",{children:xe("use-map-to-select-location")})]}):null]})]})]})]})}},9909:function(e,n,t){var i=t(5671),o=t(3144),l=t(7326),r=t(136),d=t(4062),a=t(2791),u=t(9054),s=t(184),c=function(e){(0,r.Z)(t,e);var n=(0,d.Z)(t);function t(e){var o;return(0,i.Z)(this,t),(o=n.call(this,e)).getForgeToken=function(){return{access_token:o.props.token,expires_in:3599,token_type:"Bearer"}},o.handleTokenRequested=function(e){if(console.log("Token requested by the viewer."),e){var n=o.getForgeToken();console.log("Token : "+n.access_token),n&&e(n.access_token,n.expires_in)}},o.handleDocumentLoaded=function(e,n){0===n.length?console.error("Document contains no viewables."):(console.log("handleDocumentLoaded:",n[0]),o.setViews(n),o.forceUpdate())},o.onSelectionEvent=function(e){var n=(0,l.Z)(o),t=(o.viewer.getSelection(),n.viewer.model.getData().instanceTree);if(1===e.dbIdArray.length){for(var i=e.dbIdArray[0],r=[i];i;)i=t.getNodeParentId(i),r.push(i);n.viewer.model.getBulkProperties(r,["GUID"],(function(e){if(e&&e.length>0){var t=e[0].properties[0].displayValue;console.log("GUID!!!!"),n.props.onSelectedGuid(t)}}))}},o.docs=[],o.views={},o.state={enable:!1,error:!1,empty:!0},o.viewerDiv=a.createRef(),o.viewer=null,o.resizeHandling=null,"undefined"!==typeof e.urn&&""!==e.urn&&o.docs.push(e.urn),o.state={dimensions:{width:-1,height:-1}},o}return(0,o.Z)(t,[{key:"componentDidMount",value:function(){console.log("Comp model"),this.handleScriptLoad.bind(this),this.handleScriptLoad()}},{key:"componentWillUnmount",value:function(){console.log("React Forge Viewer unmounting..."),this.viewer&&(this.viewer.removeEventListener(window.Autodesk.Viewing.SELECTION_CHANGED_EVENT,this.onSelectionEvent),this.viewer.tearDown(),this.viewer.finish(),this.viewer=null,console.log("React Forge Viewer destroyed."))}},{key:"handleLoadModelSuccess",value:function(e){console.log(window.Autodesk.Viewing),console.log("Model successfully loaded by Forge Viewer.",e),this.props.onModelLoad&&this.props.onModelLoad(this.viewer,e)}},{key:"handleLoadModelError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge model - errorCode:"+e),this.props.onModelError&&this.props.onModelError(e)}},{key:"handleViewerError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge Viewer. - errorCode:",e),this.props.onViewerError&&this.props.onViewerError(e)}},{key:"handleScriptLoad",value:function(){console.log("Autodesk scripts have finished loading.");var e={env:"AutodeskProduction",getAccessToken:this.handleTokenRequested};window.Autodesk.Viewing.Initializer(e,this.handleViewerInit.bind(this))}},{key:"handleViewerInit",value:function(){console.log("Forge Viewer has finished initializing."),this.props.proxy&&window.Autodesk.Viewing.endpoint.setEndpointAndApi(this.props.proxy,"derivativeV2");var e=this.viewerDiv.current;this.props.headless?this.viewer=new window.Autodesk.Viewing.Viewer3D(e):this.viewer=new window.Autodesk.Viewing.Private.GuiViewer3D(e),console.log("Starting the Forge Viewer...");var n=this.viewer.start();n?(console.error("Error starting Forge Viewer - code:",n),this.handleViewerError(n)):(console.log("Forge Viewer has successfully started."),this.setState({enable:!0}),this.reviewDocuments()),this.viewer.addEventListener(window.Autodesk.Viewing.SELECTION_CHANGED_EVENT,this.onSelectionEvent)}},{key:"handleLoadDocumentSuccess",value:function(e){console.log("Forge viewer has successfully loaded document:",e);var n=e.getRoot().search({type:"geometry"},!0);n.forEach((function(n){n.doc=e})),this.handleDocumentLoaded(e,n)}},{key:"handleLoadDocumentError",value:function(e){this.setState({error:!0}),console.error("Error loading Forge document - errorCode:"+e),this.props.onDocumentError&&this.props.onDocumentError(e)}},{key:"clearErrors",value:function(){this.setState({error:!1})}},{key:"clearViews",value:function(){this.views={},this.viewer&&(this.viewer.tearDown(),this.viewer.start())}},{key:"reviewDocuments",value:function(){var e=this;if(this.viewer){this.clearErrors(),console.log("reviewing documents...");Object.keys(this.docs);this.setState({empty:0===this.docs.length}),this.docs.forEach((function(n){e.loadDocument(n)}))}}},{key:"loadDocument",value:function(e){console.log("Forge Viewer is loading document:",e);var n="urn:".concat(e),t=this.handleLoadDocumentSuccess.bind(this),i=this.handleLoadDocumentError.bind(this);window.Autodesk.Viewing.Document.load(n,t,i)}},{key:"loadView",value:function(e){console.log("loading view:",e.guid),this.views[e.viewableID]=e;var n=e.doc.getViewablePath(e),t=this.handleLoadModelSuccess.bind(this),i=this.handleLoadModelError.bind(this),o={sharedPropertyDbPath:e.doc.getFullPath()};this.viewer.loadModel(n,o,t,i)}},{key:"isArrayDifferent",value:function(e,n){if(null==e&&null==n)return!1;if(null==e||null==n)return!0;if(e.length!==n.length)return!0;for(var t=0;t<e.length;t++)if(e[t]!==n[t])return!0;return!1}},{key:"shouldComponentUpdateURN",value:function(e,n){this.clearViews(),!e.urn||""===e.urn||"undefined"===typeof e.urn||Array.isArray(e.urn)&&0===e.urn.length?this.docs.length>0&&this.setDocuments([]):Array.isArray(e.urn)?this.isArrayDifferent(this.props.urn,e.urn)&&this.setDocuments(e.urn):e.urn!==this.props.urn?(this.setDocuments([e.urn]),this.loadDocument([e.urn])):this.loadDocument([e.urn])}},{key:"shouldComponentUpdateView",value:function(e,n){!e.view||"undefined"===typeof e.view||Array.isArray(e.view)&&0===e.view.length?Object.keys(this.views).length>0&&this.clearViews():Array.isArray(e.view)?this.isArrayDifferent(this.props.view,e.view)&&this.setViews(e.view):this.props.view!==e.view&&this.setViews([e.view])}},{key:"shouldComponentUpdate",value:function(e,n){return this.shouldComponentUpdateURN(e,n),this.shouldComponentUpdateView(e,n),!0}},{key:"setDocuments",value:function(e){this.docs=e,this.clearViews(),this.reviewDocuments()}},{key:"setViews",value:function(e){var n=this,t=Object.assign({},this.views),i=[];e.forEach((function(e){t.hasOwnProperty(e.viewableID)?delete t[e.viewableID]:i.push(e)})),Object.keys(t).length>0?(this.viewer.tearDown(),this.viewer.start(),e.forEach((function(e){n.loadView(e)}))):i.forEach((function(e){n.loadView(e)}))}},{key:"handleResize",value:function(e){var n=this;this.setState({dimensions:e.bounds}),this.resizeHandling&&clearTimeout(this.resizeHandling),this.resizeHandling=setTimeout((function(){n.viewer&&n.viewer.resize()}),100)}},{key:"render",value:function(){var e=this;return(0,s.jsx)(u.Z,{bounds:!0,onResize:this.handleResize.bind(this),children:function(n){var t=n.measureRef;return(0,s.jsxs)("div",{ref:t,className:"ForgeViewerContainer",children:[(0,s.jsx)("div",{ref:e.viewerDiv,className:"ForgeViewer",style:{height:e.state.dimensions.height}}),e.state.empty&&(0,s.jsx)("div",{className:"scrim",children:(0,s.jsx)("div",{className:"message",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M12.89 1.45l8 4A2 2 0 0 1 22 7.24v9.53a2 2 0 0 1-1.11 1.79l-8 4a2 2 0 0 1-1.79 0l-8-4a2 2 0 0 1-1.1-1.8V7.24a2 2 0 0 1 1.11-1.79l8-4a2 2 0 0 1 1.78 0z"}),(0,s.jsx)("polyline",{points:"2.32 6.16 12 11 21.68 6.16"}),(0,s.jsx)("line",{x1:"12",y1:"22.76",x2:"12",y2:"11"})]})})}),e.state.error&&(0,s.jsx)("div",{className:"scrim",children:(0,s.jsxs)("div",{className:"message",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,s.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,s.jsx)("line",{x1:"12",y1:"16",x2:"12",y2:"16"})]}),(0,s.jsx)("div",{children:"Viewer Error"})]})}),!e.state.enable&&(0,s.jsx)("div",{className:"scrim",children:(0,s.jsxs)("div",{className:"message",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),(0,s.jsx)("div",{children:"Starting Viewer..."})]})})]})}})}}]),t}(a.Component);n.Z=c}}]);
//# sourceMappingURL=582.bd7e8b1a.chunk.js.map